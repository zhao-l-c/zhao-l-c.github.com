
 <!DOCTYPE HTML>
<html lang="zh-cn">
<head>
  <meta charset="UTF-8">
  
    <title>Struts2完全教程（4）- 类型转换和国际化 | LC的笔记</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
    
    <meta name="author" content="zlc">
    
    <meta name="description" content="类型转换
从一个HTML表单到一个Action对象， 类型转换是从字符串到非字符串。HTTP没有 “类型” 的概念. 每一项表单输入只可能是一个字符串或一个字符串数组。在服务器端，必须把 String 转换为特定的数据类型。 在Struts2中，把请求参数映射到ValueStack栈顶属性的工作由P">
    
    
    
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/pacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/pacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">

</head>

  <body>
    <header>
      <div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.svg" alt="LC的笔记" title="LC的笔记"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="LC的笔记">LC的笔记</a></h1>
				<h2 class="blog-motto">好记性不如烂笔头</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
					<li>
					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="text" id="search" name="q" autocomplete="off" maxlength="20" placeholder="Search" />
						<input type="hidden" name="q" value="site:yoursite.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>

    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/04/27/Java/Struts2/Struts2完全教程（4）- 类型转换和国际化/" title="Struts2完全教程（4）- 类型转换和国际化" itemprop="url">Struts2完全教程（4）- 类型转换和国际化</a>
  </h1>
  <p class="article-author">By
    
      <a href="http://yoursite.com" title="zlc">zlc</a>
    </p>
  <p class="article-time">
    <time datetime="2015-04-27T11:05:15.000Z" itemprop="datePublished">4月 27 2015</time>
    Updated:<time datetime="2015-04-27T11:05:15.000Z" itemprop="dateModified">4月 27 2015</time>
    
  </p>
</header>
	<div class="article-content">
		
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">Contents</strong>
		<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#类型转换"><span class="toc-number">1.</span> <span class="toc-text">类型转换</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#类型转换失败"><span class="toc-number">1.1.</span> <span class="toc-text">类型转换失败</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#类型转换错误消息的定制"><span class="toc-number">1.2.</span> <span class="toc-text">类型转换错误消息的定制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义类型转换器"><span class="toc-number">1.3.</span> <span class="toc-text">自定义类型转换器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#复杂Model对象和表单的映射"><span class="toc-number">2.</span> <span class="toc-text">复杂Model对象和表单的映射</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#属性为JavaBean的Model"><span class="toc-number">2.1.</span> <span class="toc-text">属性为JavaBean的Model</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#属性为集合的Model"><span class="toc-number">2.2.</span> <span class="toc-text">属性为集合的Model</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#负责属性的类型转换问题"><span class="toc-number">2.3.</span> <span class="toc-text">负责属性的类型转换问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#国际化"><span class="toc-number">3.</span> <span class="toc-text">国际化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#配置国际化资源文件"><span class="toc-number">3.1.</span> <span class="toc-text">配置国际化资源文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#访问国际化消息"><span class="toc-number">3.2.</span> <span class="toc-text">访问国际化消息</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#不带占位符"><span class="toc-number">3.2.1.</span> <span class="toc-text">不带占位符</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#带占位符"><span class="toc-number">3.2.2.</span> <span class="toc-text">带占位符</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用超链接_实现动态加载国际化资源文件"><span class="toc-number">3.3.</span> <span class="toc-text">使用超链接 实现动态加载国际化资源文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#i18n拦截器的执行原理"><span class="toc-number">3.4.</span> <span class="toc-text">i18n拦截器的执行原理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#输入验证"><span class="toc-number">4.</span> <span class="toc-text">输入验证</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#声明式验证"><span class="toc-number">4.1.</span> <span class="toc-text">声明式验证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#显示验证错误消息"><span class="toc-number">4.2.</span> <span class="toc-text">显示验证错误消息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#错误消息国际化"><span class="toc-number">4.3.</span> <span class="toc-text">错误消息国际化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#短路验证"><span class="toc-number">4.4.</span> <span class="toc-text">短路验证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#验证和类型转换的问题"><span class="toc-number">4.5.</span> <span class="toc-text">验证和类型转换的问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#非字段验证"><span class="toc-number">4.6.</span> <span class="toc-text">非字段验证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#不同的属性使用相同的验证消息"><span class="toc-number">4.7.</span> <span class="toc-text">不同的属性使用相同的验证消息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义验证器"><span class="toc-number">4.8.</span> <span class="toc-text">自定义验证器</span></a></li></ol></li></ol>
		</div>
		
		<h2 id="类型转换">类型转换</h2>
<p>从一个HTML表单到一个Action对象， <strong>类型转换是从字符串到非字符串</strong>。<br>HTTP没有 “类型” 的概念. 每一项表单输入只可能是一个字符串或一个字符串数组。在服务器端，必须把 String 转换为特定的数据类型。 在Struts2中，把请求参数映射到ValueStack栈顶属性的工作由<code>ParametersInterceptor</code>拦截器负责，它是默认拦截器栈中的一员。 <code>ParametersInterceptor</code>拦截器 可以<strong>自动完成字符串和基本数据类型之间转换</strong>。</p>
<h3 id="类型转换失败">类型转换失败</h3>
<p>如果类型转换失败：</p>
<ul>
<li>若Action类没有实现<code>ValidationAware</code>接口： Struts2在遇到类型转换错误时仍会继续调用其 Action 方法，就好像什么都没发生一样；</li>
</ul>
<ul>
<li>若Action类实现<code>ValidationAware</code>接口：Struts 在遇到类型转换错误时将不会继续调用其 Action 方法。Struts2将检查相关action元素的声明是否包含着一个<code>name=&quot;input&quot;</code>的result节点。如果有，Struts2 将把控制权转交给那个result节点；若没有，Struts2将抛出类似下面这样的异常信息：</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="type">HTTP</span> <span class="type">Status</span> <span class="number">404</span> - <span class="type">No</span> <span class="literal">result</span> defined <span class="keyword">for</span> action section07.<span class="type">TestCollectionAction</span> <span class="keyword">and</span> <span class="literal">result</span> input</div></pre></td></tr></table></figure>

<p>注意，<code>ActionSupport</code>类已经实现了 <code>ValidationAware</code>接口，所以Action类只要继承<code>ActionSupport</code>，并提供 <code>name=&quot;input&quot;</code>的result节点即可进行异常处理。</p>
<p>Action类：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestConversionAction</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span> </span>{</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">8089073474694836261</span>L;</div><div class="line">    <span class="keyword">private</span> Integer age;</div><div class="line">    <span class="keyword">public</span> Integer <span class="title">getAge</span>() {</div><div class="line">        <span class="keyword">return</span> age;</div><div class="line">    }</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span>(Integer age) {</div><div class="line">        <span class="keyword">this</span>.age = age;</div><div class="line">    }</div><div class="line">    <span class="keyword">public</span> String <span class="title">execute</span>() {</div><div class="line">        System.out.println(age);</div><div class="line">        <span class="keyword">return</span> <span class="string">"success"</span>;</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>struts.xml文件</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&lt;package name=<span class="string">"section07"</span> extends=<span class="string">"struts-default"</span>&gt;                               </div><div class="line">    &lt;action name=<span class="string">"testConversion"</span>&gt;                                                </div><div class="line">        &lt;<span class="literal">result</span>&gt;/<span class="type">WEB</span>-<span class="type">INF</span>/section07/input.jsp&lt;/<span class="literal">result</span>&gt;                             </div><div class="line">    &lt;/action&gt;                                                                     </div><div class="line">    &lt;action name=<span class="string">"testConversionExecute"</span> class=<span class="string">"section07.TestConversionAction"</span>&gt;  </div><div class="line">        &lt;<span class="literal">result</span>&gt;/<span class="type">WEB</span>-<span class="type">INF</span>/section07/success.jsp&lt;/<span class="literal">result</span>&gt;    </div><div class="line">         &lt;!-- 异常处理 --&gt;                        </div><div class="line">        &lt;<span class="literal">result</span> name=<span class="string">"input"</span>&gt;/<span class="type">WEB</span>-<span class="type">INF</span>/section07/input.jsp&lt;/<span class="literal">result</span>&gt;                </div><div class="line">    &lt;/action&gt;                                                                     </div><div class="line">&lt;/package&gt;</div></pre></td></tr></table></figure>

<h3 id="类型转换错误消息的定制">类型转换错误消息的定制</h3>
<p>首先，默认拦截器栈中的conversionError（实际类型为<code>StrutsC onversionErrorInterceptor</code> ）负责类型转换错误消息的添加，当然<strong>前提是Action类实现了<code>ValidationAware</code>接口</strong>，否则拦截器不生效。</p>
<p>如何覆盖默认的出错消息？<br>（1）在对应的 Action 类所在的包中新建一个properties文件，名称就是Action类的类名：</p>
<p>（2）在properties文件中 添加<code>invalid.fieldvalue.属性名=自定义错误消息</code>格式的键值对。例如：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">invalid.fieldvalue.age</span>=<span class="string">invalid number</span></div></pre></td></tr></table></figure>

<p>（3）在name=”input”指向的页面中，可以查看栈顶的对象为：</p>
<p>因此可以使用EL表达式或者 s:fielderror 标签获取自定义的错误消息，即：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="variable">${fieldErrors.age[0]}</span></div></pre></td></tr></table></figure>

<p>或者：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;<span class="variable">s:fielderror</span> name=<span class="string">"age"</span>/&gt;</div></pre></td></tr></table></figure>

<p><strong>使用 s:fielderror 标签和EL表达式的最大区别就是， s:fielderror 标签会把所有的错误信息都显示处理，而EL只会显示一个！</strong></p>
<p>（4）<strong>建议使用EL表达式</strong>，因为在标签不同主题下， s:fielderror显示的格式不统一，即翻译后的HTML会带有ul、li和span等标签。<br>如果一定要使用 s:fielderror标签，则可以修改 s:fielderror标题的ftl文件。</p>
<blockquote>
<p>修改方法<br>在struts2-core-xxx.jar包下的 template.simple包下面fielderror.ftl文件定义了simple主题下s:fielderror标签显示错误消息的样式。所以修改该</p>
</blockquote>
<p>配置文件即可。步骤是在当前项目的src目录下新建template.simple 包，新建fielderror.ftl 文件，把原生的 fielderror.ftl 中的内容 复制到新建的 fielderror.ftl 中，然后剔除ftl文件中的 ul，li，span 部分即可。</p>
<h3 id="自定义类型转换器">自定义类型转换器</h3>
<p>（1）首先实现<code>StrutsTypeConverter</code>类，并重写2个方法。<br>示例：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DateTypeConverter</span> <span class="keyword">extends</span> <span class="title">StrutsTypeConverter</span> </span>{</div><div class="line">    <span class="keyword">private</span> DateFormat format;</div><div class="line"> </div><div class="line">    <span class="keyword">public</span> <span class="title">DateTypeConverter</span>() {</div><div class="line">        System.out.println(<span class="string">"DateTypeConverter constructor..."</span>);</div><div class="line">        format = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd"</span>);</div><div class="line">    }</div><div class="line"> </div><div class="line">    <span class="annotation">@SuppressWarnings</span>(<span class="string">"rawtypes"</span>)</div><div class="line">    <span class="annotation">@Override</span></div><div class="line">    <span class="keyword">public</span> Object <span class="title">convertFromString</span>(Map context, String[] values, Class toClass) {</div><div class="line">        System.out.println(<span class="string">"DateTypeConverter convertFromString..."</span>);</div><div class="line">        <span class="keyword">if</span>(toClass == Date.class) {</div><div class="line">            <span class="keyword">if</span>(values != <span class="keyword">null</span> && values.length == <span class="number">1</span>) {</div><div class="line">                <span class="comment">// 只能捕获异常，不能抛出</span></div><div class="line">                <span class="keyword">try</span> {</div><div class="line">                    <span class="keyword">return</span> format.parseObject(values[<span class="number">0</span>]);</div><div class="line">                } <span class="keyword">catch</span> (ParseException e) {</div><div class="line">                    e.printStackTrace();</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keyword">return</span> values;</div><div class="line">    }</div><div class="line"> </div><div class="line">    <span class="annotation">@SuppressWarnings</span>(<span class="string">"rawtypes"</span>)</div><div class="line">    <span class="annotation">@Override</span></div><div class="line">    <span class="keyword">public</span> String <span class="title">convertToString</span>(Map context, Object o) {</div><div class="line">        System.out.println(<span class="string">"convertFromString convertToString..."</span>);</div><div class="line">        <span class="keyword">if</span>(o <span class="keyword">instanceof</span> Date) {</div><div class="line">            <span class="keyword">return</span> format.format(o);</div><div class="line">        }</div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p><strong>注意，这两个方法都没有抛出异常，也就是使用自定义类型转换器的时候，需要自主完成对异常的捕获处理。</strong></p>
<p>（2）配置类型转换器。自定了转换器后还需要进行配置系统才会识别使用，有2种方法：</p>
<ul>
<li>基于属性的配置方式。<br>这时候需要提供一个properties文件，文件的内容为<code>需要转换的属性名=转换器全类名</code>。例如：</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">birth</span>=<span class="string">section07.DateTypeConverter</span></div></pre></td></tr></table></figure>

<p>文件的命名有2种情况方式：</p>
<pre><code>+ <span class="keyword">*</span><span class="keyword">*</span>如果需要转换的属性在Action类中，则以`Action类类名-conversion.properties`作为文件名， 并放置在该包 <span class="keyword">*</span><span class="keyword">*</span>：
</code></pre><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">TestConversionAction-<span class="transposed_variable">conversion.</span><span class="keyword">properties</span></div></pre></td></tr></table></figure>

<pre><code>+ <span class="keyword">*</span><span class="keyword">*</span>若属性封装在Model中，则以`Model类名-conversion.properties`作为文件名，并放置在该包下<span class="keyword">*</span><span class="keyword">*</span>。
</code></pre><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Customer-<span class="transposed_variable">conversion.</span><span class="keyword">properties</span></div></pre></td></tr></table></figure>

<p>无论哪种命名方法，<strong>类型转换器都会在使用的时候创建</strong>，也即它是单例的。</p>
<ul>
<li>基于类型的配置。此时需要在src目录下新建一个名为<code>xwork-conversion.properties</code>的文件，内容为<code>类型=转换器全类名</code>。例如：</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">java.util.Date</span>=<span class="string">section07.DateTypeConverter</span></div></pre></td></tr></table></figure>

<p>这时候，这个类型转换器会在Struts2项目创建时实例化，<strong>而且通过源码调试发现它创建了2次</strong>！<br><strong>这种方式还注意，在实例化这个转换器的时候，Struts的很多工具还没有初始化完成，例如<code>ServletContext</code>，所以使用这种方法需要小心。</strong></p>
<blockquote>
<p>补充内容：把日期类型转换的格式设置在web.xml文件中，并在类型转换器中获取<br>也就是在这个类型转换其中去获取web.xml中定义的初始化参数，此时类型转换器的代码为：</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DateTypeConverter</span> <span class="keyword">extends</span> <span class="title">StrutsTypeConverter</span> </span>{</div><div class="line">    <span class="keyword">private</span> DateFormat format;</div><div class="line">    <span class="keyword">public</span> DateFormat <span class="title">getDateFormat</span>() {</div><div class="line">        <span class="keyword">if</span>(format == <span class="keyword">null</span>) {</div><div class="line">            String pattern = ServletActionContext.getServletContext().getInitParameter(<span class="string">"date_pattern"</span>);</div><div class="line">            format = <span class="keyword">new</span> SimpleDateFormat(pattern);</div><div class="line">        }</div><div class="line">        <span class="keyword">return</span> format;</div><div class="line">    }</div><div class="line">    <span class="comment">// 重写的2个方法并没有改变</span></div><div class="line"></div><div class="line">}</div></pre></td></tr></table></figure>

<h2 id="复杂Model对象和表单的映射">复杂Model对象和表单的映射</h2>
<p>通常情况下Model对象的属性都是基本数据类型，但也可以是JavaBean类型或者集合类型，下面分别说明。</p>
<h3 id="属性为JavaBean的Model">属性为JavaBean的Model</h3>
<p>Struts2的表单标签<strong>name属性可以被映射为属性的属性</strong>，也就是可以一直遍历下去。</p>
<p>例如下面的Department类中包含了Manager类型的属性：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> Department {</div><div class="line">    <span class="keyword">private</span> Integer id;</div><div class="line">    <span class="keyword">private</span> String deptName;</div><div class="line">    <span class="comment">// JavaBean属性</span></div><div class="line">    <span class="keyword">private</span> Manager manager;</div><div class="line">    <span class="comment">// getter、setter省略</span></div><div class="line"></div><div class="line">}</div></pre></td></tr></table></figure>

<p>当Department作为Action类的Model时，在表单中可以这样设置它的属性：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">s:form</span> <span class="attribute">action</span>=<span class="value">"saveComplexModel.action"</span> <span class="attribute">method</span>=<span class="value">"post"</span>&gt;</span>        </div><div class="line">    <span class="tag">&lt;<span class="title">s:textfield</span> <span class="attribute">name</span>=<span class="value">"deptName"</span> <span class="attribute">label</span>=<span class="value">"DepartmentName"</span>/&gt;</span>      </div><div class="line">    <span class="comment">&lt;!-- 映射JavaBean属性的属性 --&gt;</span>                                   </div><div class="line">    <span class="tag">&lt;<span class="title">s:textfield</span> <span class="attribute">name</span>=<span class="value">"manager.name"</span> <span class="attribute">label</span>=<span class="value">"ManagerName"</span>/&gt;</span>     </div><div class="line">    <span class="tag">&lt;<span class="title">s:textfield</span> <span class="attribute">name</span>=<span class="value">"manager.birth"</span> <span class="attribute">label</span>=<span class="value">"ManagerBirth"</span>/&gt;</span>   </div><div class="line">    <span class="tag">&lt;<span class="title">s:submit</span>/&gt;</span>                                                </div><div class="line"><span class="tag">&lt;/<span class="title">s:form</span>&gt;</span></div></pre></td></tr></table></figure>

<h3 id="属性为集合的Model">属性为集合的Model</h3>
<p>假设在JSP中有下列的属性：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&lt;form action=<span class="string">"saveCollectionProperty.action"</span> method=<span class="string">"post"</span>&gt;     </div><div class="line">    <span class="constant">Managers</span>[<span class="number">0</span>].<span class="constant">Name</span><span class="symbol">:&lt;input</span> name=<span class="string">"managers[0].name"</span> /&gt;          </div><div class="line">    <span class="constant">Managers</span>[<span class="number">0</span>].<span class="constant">Birth</span><span class="symbol">:&lt;input</span> name=<span class="string">"managers[0].birth"</span> /&gt;        </div><div class="line">    &lt;br/&gt;                                                       </div><div class="line">    <span class="constant">Managers</span>[<span class="number">1</span>].<span class="constant">Name</span><span class="symbol">:&lt;input</span> name=<span class="string">"managers[1].name"</span> /&gt;          </div><div class="line">    <span class="constant">Managers</span>[<span class="number">1</span>].<span class="constant">Birth</span><span class="symbol">:&lt;input</span> name=<span class="string">"managers[1].birth"</span> /&gt;        </div><div class="line">    &lt;br/&gt;                                                       </div><div class="line">    <span class="constant">Managers</span>[<span class="number">2</span>].<span class="constant">Name</span><span class="symbol">:&lt;input</span> name=<span class="string">"managers[2].name"</span> /&gt;          </div><div class="line">    <span class="constant">Managers</span>[<span class="number">2</span>].<span class="constant">Birth</span><span class="symbol">:&lt;input</span> name=<span class="string">"managers[2].birth"</span> /&gt;        </div><div class="line">    &lt;br/&gt;                                                       </div><div class="line">    &lt;input type=<span class="string">"submit"</span> value=<span class="string">"Submit"</span>/&gt;                       </div><div class="line">&lt;<span class="regexp">/form&gt;</span></div></pre></td></tr></table></figure>




<p>这时候很明显managers是一个JavaBean，且这里的Model是一个集合，所以Action类中可以定义为<code>List</code>或者<code>Collection</code>类型：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestCollectionAction</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span></span>{</div><div class="line"> </div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1</span>L;</div><div class="line"> </div><div class="line">    <span class="keyword">private</span> List&lt;Manager&gt; managers;</div><div class="line"> </div><div class="line">    <span class="keyword">public</span> List&lt;Manager&gt; <span class="title">getManagers</span>() {</div><div class="line">        <span class="keyword">return</span> managers;</div><div class="line">    }</div><div class="line">    <span class="comment">// 省略action 方法</span></div><div class="line"></div><div class="line">}</div></pre></td></tr></table></figure>

<p><strong>注意，不能定义为数组或者<code>Iterator</code>类型！</strong></p>
<h3 id="负责属性的类型转换问题">负责属性的类型转换问题</h3>
<p>对于上面两种情况下的属性，如果需要使用自定义的类型转换器，则只能使用<strong>基于类型的配置方式，</strong>也就是只能是用src下的 <code>xwork-conversion.properties</code>文件进行特定类型到转换器的配置。</p>
<h2 id="国际化">国际化</h2>
<h3 id="配置国际化资源文件">配置国际化资源文件</h3>
<p>国际化资源文件可以在3个范围内配置：</p>
<ul>
<li>Action范围资源文件：在Action类文件所在的路径建立名为<code>ActionName_language_country.properties</code>的 属性 文件；</li>
</ul>
<ul>
<li><p>包范围资源文件：在包的根路径下建立文件名为<code>package_language_country.properties</code>的属性文件， 一旦建立，处于该包下的所有Action类都可以访问该资源文件。<strong>注意：包范围资源文件的baseName就是package，不是Action所在的包名</strong>；</p>
</li>
<li><p>全局资源文件： 在src目录下<code>basename_language_country.properties</code>属性文件，并且需要在struts.xml文件中声明该资源文件：</p>
</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">struts.xml &lt;constant <span class="variable">name=</span><span class="string">"struts.custom.i18n.resources"</span> <span class="variable">value=</span><span class="string">"baseName"</span>/&gt;</div></pre></td></tr></table></figure>


<p>国际化资源文件加载的顺序如何呢 ?<br><strong>基本规则就是离当前Action类较近的将被优先加载。</strong></p>
<h3 id="访问国际化消息">访问国际化消息</h3>
<p>可以在JSP或者Action中根据key属性值获取对应的国际化value值。</p>
<h4 id="不带占位符">不带占位符</h4>
<p>首先是对不带占位符的属性进行访问，例如下面的：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="variable">username=</span>Username</div><div class="line"><span class="variable">password=</span>Password</div><div class="line"><span class="variable">submit=</span>Submit</div></pre></td></tr></table></figure>

<ul>
<li>在JSP中，一般使用标签的方式，也可以调用<code>getText()</code>方法并强制OGNL解析：<ul>
<li>表单标签的key属性访问 国际化消息 。 例如：</li>
</ul>
</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;s:textfield <span class="variable">name=</span><span class="string">"username"</span> <span class="variable">key=</span><span class="string">"username"</span>/&gt;</div></pre></td></tr></table></figure>

<p>或者还是使用lable，但 调用<code>getText()</code>方法并强制OGNL解析：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;s:textfield <span class="variable">label=</span><span class="string">"%{getText('username')}"</span> <span class="variable">theme=</span><span class="string">"xhtml"</span>/&gt;</div></pre></td></tr></table></figure>

<p><strong>注意，这种情况不适合theme=”simple”，因为这时候并不会对s标签的key和label属性进行翻译。</strong></p>
<pre><code>+ 使用<span class="variable">s:text</span>标签访问 国际化消息 ，在任何主题下都有效。例如：
</code></pre><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;s:text <span class="variable">name=</span><span class="string">"username"</span>/&gt;: &lt;s:textfield <span class="variable">name=</span><span class="string">"username"</span> <span class="variable">key=</span><span class="string">"username"</span> <span class="variable">theme=</span><span class="string">"simple"</span>/&gt;</div></pre></td></tr></table></figure>

<p><strong>所以建议都使用s:text标签。</strong></p>
<ul>
<li>Action类中获取方法。<br><code>TextProvider</code>接口提供了<code>getText</code>方法访问 国际化消息 ，<code>ActionSupport</code>最终会实现该接口，<strong>所以Action类需要继承<code>ActionSupport</code></strong>：</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="constant">String username</span> = getText(<span class="string">"username"</span>);</div></pre></td></tr></table></figure>

<h4 id="带占位符">带占位符</h4>
<p>带占位符或者EL符资源文件，例如：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">time=Time:<span class="list">{0}</span></div><div class="line">age=Age:$<span class="list">{number}</span></div></pre></td></tr></table></figure>

<ul>
<li>在JSP中，使用s:text访问带占位符或者EL符的 国际化消息 。<br>例如对于上面的time属性，方法是：</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;s:<span class="keyword">text</span> name=<span class="string">"time"</span>&gt;                </div><div class="line">    &lt;s:<span class="built_in">param</span> <span class="built_in">value</span>=<span class="string">"date"</span>&gt;&lt;/s:<span class="built_in">param</span>&gt;</div><div class="line">&lt;/s:<span class="keyword">text</span>&gt;</div></pre></td></tr></table></figure>

<p>占位符<code>{0}</code>这时候用s:param填充，而且当前ValueStack需要有<strong>date属性（注意并不是time，time是国际化资源的key）</strong>，也就是处理请求的Action类中有date属性值且提供了getter方法！<br>对于带EL符的age属性，方法是：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;s:<span class="type">text</span> <span class="property">name</span>=<span class="string">"age"</span>/&gt;</div></pre></td></tr></table></figure>

<p>这时候ValueStack中也要有<strong>number属性（注意并不是age，age是国际化资源的key）</strong>，同理需要提供getter方法。</p>
<ul>
<li>在Action类中，还是通过继续<code>ActionSupport</code>，调用<code>getText</code>的重载方法，例如：</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">String</span> time = getText(<span class="string">"time"</span>, <span class="keyword">Arrays</span>.asList(new <span class="keyword">Date</span>()));</div><div class="line">// 或者使用下面的传值方式</div><div class="line">// <span class="keyword">String</span> time = getText(<span class="string">"time"</span>, new <span class="keyword">String</span>[]<span class="list">{new Date().toString()}</span>);</div></pre></td></tr></table></figure>

<p>在Action类中无法获取使用EL符号的 国际化消息 。</p>
<h3 id="使用超链接_实现动态加载国际化资源文件">使用超链接 实现动态加载国际化资源文件</h3>
<p>方法非常简单，就是在请求URL后面加上参数<strong> request_locale</strong>，Struts2的i18n拦截器 （具体类型为<code>I18nInterceptor</code>） 会根据这个参数值进行判断，自动加载国际化资源文件，进行全局的设置。<br>例如：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"testI18N_Action.action?request_locale=en_US"</span>&gt;</span>英文<span class="tag">&lt;/<span class="title">a</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">br</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"testI18N_Action.action?request_locale=zh_CN"</span>&gt;</span>中文<span class="tag">&lt;/<span class="title">a</span>&gt;</span></div></pre></td></tr></table></figure>

<p><strong>注意，这时候的请求必须经过Action，否则i18n拦截器不会工作！</strong></p>
<h3 id="i18n拦截器的执行原理">i18n拦截器的执行原理</h3>
<p>Struts2 使用i18n拦截器处理国际化，并且将其注册在默认的拦截器栈中。</p>
<p>下面是i18n拦截器处理国际的过程：</p>
<p>简单总结：<br>（1）i18n拦截器在执行Action方法前，自动查找请求中一个名为<strong>request_locale</strong>的参数。如果该参数存在，拦截器就将其作为参数，转换成<code>Locale</code>对象（ 代表国家/语言环境） ，并将其设为用户默认的<code>Locale</code>。并把其设置在Session范围中，键为<strong>WW_TRANS_I18N_LOCALE</strong>；</p>
<p>（2）若request没有名为<strong>request_locale</strong>的参数，则i18n拦截器会从 Session中获取键为<strong>WW_TRANS_I18N_LOCALE</strong>的属性值，若该值不为空，则将该属性值设置为浏览者的默认<code>Locale</code>；</p>
<p>（3）若Session中的<strong>WW_TRANS_I18N_LOCALE</strong>的属性值为空，则从<code>ActionContext</code>中获取<code>Locale</code>对象。</p>
<h2 id="输入验证">输入验证</h2>
<p>Struts2 提供了一些基于 XWork Validation Framework 的内建验证程序，使用这些验证器不需要编程，只要在一个 XML 文件里对验证程序应该如何工作作出声明就可以了，这就是所谓的<strong>声明式验证</strong>。需要声明的内容包括：</p>
<ul>
<li>哪些字段需要进行验证；</li>
<li>使用什么验证规则；</li>
<li>在验证失败时应该把什么样的出错消息发送到浏览器端；<br><strong>这些验证器在xwork-core-xxx.jar包下的com.opensymphony.xwork2.validator.validators.default.xml文件中声明，可以查看这个文件了解相关的验证器。</strong></li>
</ul>
<h3 id="声明式验证">声明式验证</h3>
<p>声明式验证程序可以分为两类：</p>
<ul>
<li>字段验证：判断某个字段属性的输入是否有效；</li>
<li>非字段验证：不只针对某个字段，而是针对多个字段的输入值之间的逻辑关系进行校验。例如：对再次输入密码的判断。</li>
</ul>
<p><strong>使用声明式验证需要 3 个步骤</strong>：<br>（1）确定哪些 Action或Model的字段需要验证，此外Action类需要实现<code>Validateable</code>接口或者直接继承<code>ActionSupport</code>父类；</p>
<p>（2）编写一个验证程序配置文件，<strong>配置方法可以参考文档struts-xxxx/docs/WW/docs/validation.html的说明</strong>。<br>注意，它的文件名必须是以下两种格式之一：</p>
<ul>
<li>若一个 Action 类的多个 action 使用<strong>同样的验证规则</strong>：ActionClassName-validation.xml；<br>示例：</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="doctype">&lt;!DOCTYPE validators PUBLIC</span></div><div class="line">        "-//Apache Struts//XWork Validator 1.0.2//EN"</div><div class="line">        "http://struts.apache.org/dtds/xwork-validator-1.0.2.dtd"&gt;</div><div class="line"><span class="tag">&lt;<span class="title">validators</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">field</span> <span class="attribute">name</span>=<span class="value">"age"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="title">field-validator</span> <span class="attribute">type</span>=<span class="value">"int"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="title">param</span> <span class="attribute">name</span>=<span class="value">"max"</span>&gt;</span>120<span class="tag">&lt;/<span class="title">param</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="title">param</span> <span class="attribute">name</span>=<span class="value">"min"</span>&gt;</span>0<span class="tag">&lt;/<span class="title">param</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="title">message</span>&gt;</span>age needs to be between ${min} and ${max}<span class="tag">&lt;/<span class="title">message</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="title">field-validator</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="title">field</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">validators</span>&gt;</span></div></pre></td></tr></table></figure>

<p>这里用到了<strong>int</strong>验证器，查看 com.opensymphony.xwork2.validator.validators.default.xml文件可以知道 对应的类型为<code>IntRangeFieldValidator</code>。</p>
<ul>
<li>若一个 Action 类的多个 action 使用<strong>不同的验证规则</strong>：ActionClass-requestURL-validation.xml，其中 requestURL是请求Action的URL。<br>例如：<br>有一个页面可以用于创建用户或者修改用户，当创建用户是提交URL为 <strong> new_user </strong> ，修改用户时提交URL为 <strong> edit_user </strong> ，创建和修改都是由同一个Action类处理，这时候可以为创建和修改定义2个验证文件： <strong> TestValidationAction-edit_user-validation.xml </strong> 和 <strong> TestValidationAction-new_user-validation.xml </strong> 。<br>两个文件中分别针对name属性有不一样的验证要求， 同时它们对于age属性使用一样的验证要求，所以对于age属性还需要提供一个统一的验证文件： <strong> TestValidationAction-validation.xml </strong> 。<br><strong> 最后在这3个文件中分别编写验证属性和内容，并且都可以国际化 </strong> 。</li>
</ul>
<p>（3）确定验证失败时的响应页面：在 struts.xml 文件中定义一个<code>&lt;result name=&quot;input&quot;&gt;</code>的元素：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;action name=<span class="string">"testValication"</span> class=<span class="string">"section09.TestValidationAction"</span>&gt;</div><div class="line">     &lt;<span class="literal">result</span>&gt;/<span class="type">WEB</span>-<span class="type">INF</span>/section09/success.jsp&lt;/<span class="literal">result</span>&gt;</div><div class="line">     &lt;<span class="literal">result</span> name=<span class="string">"input"</span>&gt;/<span class="type">WEB</span>-<span class="type">INF</span>/section09/testValidation.jsp&lt;/<span class="literal">result</span>&gt;</div><div class="line">&lt;/action&gt;</div></pre></td></tr></table></figure>

<h3 id="显示验证错误消息">显示验证错误消息</h3>
<p>这里只对theme为simple的情况说明。</p>
<p>在JSP页面中可以使用s:fielderror标签或者EL表达式显示验证错误消息，例如使用s:fielderror标签：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;<span class="variable">s:fielderror</span> fieldName=<span class="string">"age"</span>/&gt;</div></pre></td></tr></table></figure>

<p>或者使用EL表达式：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="variable">${fieldErrors.age[0] }</span></div></pre></td></tr></table></figure>

<p><strong>可以在页面中添加s:debug标签查看这时候值栈的内容从而确定如何获取错误消息。</strong></p>
<h3 id="错误消息国际化">错误消息国际化</h3>
<p>首先提供国际化资源文件，例如在src下定义全局的资源文件，内容为：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">age.int=age needs <span class="built_in">to</span> be between ${<span class="built_in">min</span>} <span class="operator">and</span> ${<span class="built_in">max</span>}</div></pre></td></tr></table></figure>

<p><strong>可以看到资源文件中支持使用EL符号表示的占位符。</strong></p>
<p>然后修改属性验证XML文件为：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">validators</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">field</span> <span class="attribute">name</span>=<span class="value">"age"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="title">field-validator</span> <span class="attribute">type</span>=<span class="value">"int"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="title">param</span> <span class="attribute">name</span>=<span class="value">"max"</span>&gt;</span>120<span class="tag">&lt;/<span class="title">param</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="title">param</span> <span class="attribute">name</span>=<span class="value">"min"</span>&gt;</span>0<span class="tag">&lt;/<span class="title">param</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="title">message</span> <span class="attribute">key</span>=<span class="value">"age.int"</span>&gt;</span><span class="tag">&lt;/<span class="title">message</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="title">field-validator</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="title">field</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">validators</span>&gt;</span></div></pre></td></tr></table></figure>

<p><strong>也就是message标签使用key属性获取资源文件对应的键。</strong></p>
<h3 id="短路验证">短路验证</h3>
<p>加入对某个字段声明了多个验证器，例如对于age属性：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">validators</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">field</span> <span class="attribute">name</span>=<span class="value">"age"</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!-- 测试短路验证 --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="title">field-validator</span> <span class="attribute">type</span>=<span class="value">"conversion"</span> <span class="attribute">short-circuit</span>=<span class="value">"true"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="title">message</span> <span class="attribute">key</span>=<span class="value">"age.conversion"</span>&gt;</span><span class="tag">&lt;/<span class="title">message</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="title">field-validator</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="title">field-validator</span> <span class="attribute">type</span>=<span class="value">"int"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="title">param</span> <span class="attribute">name</span>=<span class="value">"max"</span>&gt;</span>120<span class="tag">&lt;/<span class="title">param</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="title">param</span> <span class="attribute">name</span>=<span class="value">"min"</span>&gt;</span>0<span class="tag">&lt;/<span class="title">param</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="title">message</span> <span class="attribute">key</span>=<span class="value">"age.int"</span>&gt;</span><span class="tag">&lt;/<span class="title">message</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="title">field-validator</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="title">field</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">validators</span>&gt;</span></div></pre></td></tr></table></figure>

<p>这时候假如2个验证器都生效，则会产生2条错误消息，使用s:fielderror标签会显示全部错误消息。</p>
<p>解决方法：</p>
<ul>
<li>在第一个filed-validator中添加short-circuit=”true”，表示短路验证，即当前验证器出错后就不执行后面的验证器了；</li>
</ul>
<ul>
<li>使用EL表达式获取错误消息。此时多个验证器还是执行了，但EL表达式可以获取单条消息。</li>
</ul>
<h3 id="验证和类型转换的问题">验证和类型转换的问题</h3>
<p>注意区分这两者，验证是有默认拦截器栈中的validation拦截器负责，而类型转换是由params和conversionError拦截器负责。<strong>一般params和conversionError会在validation前面。</strong></p>
<p>这时候就会有这样的问题：<br>假如对于个字段age，需要它是一个数字类型，则在Action类中声明为Integer类型的属性。同时为这个属性声明了<strong>conversion</strong>验证器，这时候默认情况下会出现2条错误信息，<strong>因为类型转换拦截器和验证器都生效了</strong>！</p>
<p>解决方法：</p>
<ul>
<li>同样类似短路验证，使用EL表达式获取错误消息；</li>
</ul>
<ul>
<li>修改 conversionError拦截器。由于类型转换的错误消息是由 conversionError拦截器添加的，这时候可以在项目中重写这个拦截器类型，并且修改里面的代码，在执行<code>return invocation.invoke();</code>的前面加上：</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ConversionErrorInterceptor</span></div><div class="line"><span class="keyword">public</span> String <span class="title">intercept</span>(ActionInvocation invocation) <span class="keyword">throws</span> Exception {</div><div class="line"></div><div class="line">    <span class="comment">// ......省略</span></div><div class="line"></div><div class="line">    <span class="comment">// 如果有类型转换错误消息则直接返回input</span></div><div class="line"></div><div class="line">    Object action = invocation.getAction();</div><div class="line">    <span class="keyword">if</span> (action <span class="keyword">instanceof</span> ValidationAware) {</div><div class="line">        ValidationAware va = (ValidationAware) action;</div><div class="line"> </div><div class="line">        <span class="keyword">if</span>(va.hasFieldErrors() || va.hasActionErrors()){</div><div class="line">            <span class="keyword">return</span> <span class="string">"input"</span>;</div><div class="line">        }</div><div class="line">    }</div><div class="line">    <span class="keyword">return</span> invocation.invoke();</div><div class="line">}</div></pre></td></tr></table></figure>

<p>也就是当类型转换错误后就直接返回，并不会继续执行后面的validation拦截器，所以就保证了错误消息的唯一。</p>
<h3 id="非字段验证">非字段验证</h3>
<p>前面说过，声明式验证包括字段验证和非字段验证。<strong>非字段验证主要是对规则的验证，例如判断2个密码输入框中的密码是否一致</strong>。</p>
<p>示例：当2个密码框的值不一致的时候进行错误提示。<br>例如下面的密码提交页面：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;s:form action=<span class="string">"testValidation2.action"</span> <span class="keyword">method</span>=<span class="string">"post"</span> theme=<span class="string">"simple"</span>&gt;</div><div class="line">    password:&lt;s:password name=<span class="string">"password"</span>/&gt;       </div><div class="line">    &lt;br/&gt;                                                           </div><div class="line">    password2:&lt;s:password name=<span class="string">"password2"</span>/&gt;                        </div><div class="line">    &lt;s:submit label=<span class="string">"Submit"</span>/&gt;                                      </div><div class="line">&lt;/s:form&gt;</div></pre></td></tr></table></figure>

<p>首先配置Action类的验证文件：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">validators</span>&gt;</span></div><div class="line"></div><div class="line">     <span class="tag">&lt;<span class="title">validator</span> <span class="attribute">type</span>=<span class="value">"expression"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="title">param</span> <span class="attribute">name</span>=<span class="value">"expression"</span>&gt;</span><span class="cdata">&lt;![CDATA[password==password2]]&gt;</span><span class="tag">&lt;/<span class="title">param</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="title">message</span>&gt;</span>Password is not equals to password2<span class="tag">&lt;/<span class="title">message</span>&gt;</span></div><div class="line">     <span class="tag">&lt;/<span class="title">validator</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">validators</span>&gt;</span></div></pre></td></tr></table></figure>

<p><strong>可以看到这里使用的是expression验证器。</strong></p>
<p>最后但不一致是在JSP中获取错误消息，通过s:debug标签查看值栈内容发现此时错误消息放置在actionErrors数组中，因此可以使用s:actionerror标签或者EL表达式获取：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;<span class="variable">s:actionerror</span>/&gt;</div></pre></td></tr></table></figure>

<p>或者：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="variable">${actionErrors[0] }</span></div></pre></td></tr></table></figure>

<h3 id="不同的属性使用相同的验证消息">不同的属性使用相同的验证消息</h3>
<p>一般会把验证消息放置在资源文件中方便国际处理，这时候</p>
<p>例如对于表单中的age和count都使用相同的int验证器，同时使用相同的错误消息，这时候这样配置验证文件：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">validators</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">field</span> <span class="attribute">name</span>=<span class="value">"age"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="title">field-validator</span> <span class="attribute">type</span>=<span class="value">"int"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="title">param</span> <span class="attribute">name</span>=<span class="value">"max"</span>&gt;</span>120<span class="tag">&lt;/<span class="title">param</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="title">param</span> <span class="attribute">name</span>=<span class="value">"min"</span>&gt;</span>0<span class="tag">&lt;/<span class="title">param</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="title">message</span> <span class="attribute">key</span>=<span class="value">"age.cout.int"</span>&gt;</span><span class="tag">&lt;/<span class="title">message</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="title">field-validator</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="title">field</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">field</span> <span class="attribute">name</span>=<span class="value">"count"</span>&gt;</span></div><div class="line">         <span class="tag">&lt;<span class="title">field-validator</span> <span class="attribute">type</span>=<span class="value">"int"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="title">param</span> <span class="attribute">name</span>=<span class="value">"max"</span>&gt;</span>100<span class="tag">&lt;/<span class="title">param</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="title">param</span> <span class="attribute">name</span>=<span class="value">"min"</span>&gt;</span>20<span class="tag">&lt;/<span class="title">param</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="title">message</span> <span class="attribute">key</span>=<span class="value">"age.cout.int"</span>&gt;</span><span class="tag">&lt;/<span class="title">message</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="title">field-validator</span>&gt;</span></div><div class="line">     <span class="tag">&lt;/<span class="title">field</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">validators</span>&gt;</span></div></pre></td></tr></table></figure>

<p>也就是message的key属性获取资源文件中相同的值就行。</p>
<p>这时候定义的资源文件为：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">age.cout.<span class="keyword">int</span>=<span class="variable">${fieldName}</span> needs to be between <span class="variable">${min}</span> <span class="keyword">and</span> <span class="variable">${max}</span></div></pre></td></tr></table></figure>

<p><strong>注意，这里的fieldName是固定的名字，表示获取验证配置文件中<code>&lt;field name=&quot;count&quot;&gt;</code>声明的属性值。它其实是验证器<code>IntRangeFieldValidator</code>类型中的属性，在进行验证操作的时候会被赋值。</strong></p>
<p>但也可以对这个fieldName进行修改，例如此时的错误消息修改为：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">age.cout.int=<span class="variable">${</span>getText(fieldName)} needs to be between <span class="variable">${</span>min} <span class="keyword">and</span> <span class="variable">${</span>max}</div><div class="line">age=<span class="constant">Age</span></div><div class="line">count=<span class="constant">Count</span></div></pre></td></tr></table></figure>

<p>这时候表示获取到把fieldName作为参数调用<code>TextProvider</code>中的<code>getText</code>方法，而<code>TextProvider</code>是进行资源文件读取的接口。所以当fieldName为age的时候，会再去获取age的值！</p>
<h3 id="自定义验证器">自定义验证器</h3>
<p>Struts2提供了一系列的验证器，在xwork-core-xxx.jar包下的com.opensymphony.xwork2.validator.validators.default.xml下可以查看。</p>
<p>但也可以自定义验证器。<br>自定义验证器要求实现<code>Validator</code>接口，这个接口有很多实现类，其中 可以选择继承<code>ValidatorSupport</code>或<code>FieldValidatorSupport</code>类：</p>
<ul>
<li><p>若希望实现一个一般的验证器，则可以继承<code>ValidatorSupport</code>；</p>
</li>
<li><p>若希望实现一个字段验证器，则可以继承<code>FieldValidatorSupport</code>；</p>
</li>
<li>若验证程序需要接受一个输入参数， 需要为这个参数增加一个相应的属性并提供getter、setter方法。</li>
</ul>
<p>示例：自定义一个校验身份证号是否有效的验证器，代码为：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IDCardValidator</span> <span class="keyword">extends</span> <span class="title">FieldValidatorSupport</span></span>{</div><div class="line">    <span class="keyword">private</span> Integer length = -<span class="number">1</span>;</div><div class="line">    <span class="keyword">public</span> Integer <span class="title">getLength</span>() {</div><div class="line">        <span class="keyword">return</span> length;</div><div class="line">    }</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLength</span>(Integer length) {</div><div class="line">        <span class="keyword">this</span>.length = length;</div><div class="line">    }</div><div class="line"> </div><div class="line">    <span class="annotation">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">validate</span>(Object object) <span class="keyword">throws</span> ValidationException {</div><div class="line">        String fieldName = getFieldName();</div><div class="line">        String value = (String)<span class="keyword">this</span>.getFieldValue(fieldName, object);</div><div class="line"> </div><div class="line">        <span class="keyword">if</span>(value.length() != getLength()) {</div><div class="line">            addFieldError(fieldName, object);</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        }</div><div class="line">        IDCard verify = <span class="keyword">new</span> IDCard();</div><div class="line">        <span class="keyword">if</span>(!verify.Verify(value)) {</div><div class="line">            addFieldError(fieldName, object);</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>可以参考已有验证器的代码实现。</p>
<p>配置验证器：<br>默认情况下下，Struts2 会在src目录下加载名为validators.xml的文件，在该文件中加载验证器。 该文件的定义方式同默认的验证器的配置文件（即位于 com.opensymphony.xwork2.validator.validators下的 default.xml）。<br><strong>因此可以在src目录下配置validatorx.xml文件，里面加入自定义的验证器。</strong>例如：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="pi">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></div><div class="line"><span class="doctype">&lt;!DOCTYPE validators PUBLIC</span></div><div class="line">        "-//Apache Struts//XWork Validator Definition 1.0//EN"</div><div class="line">        "http://struts.apache.org/dtds/xwork-validator-definition-1.0.dtd"&gt;</div><div class="line"> </div><div class="line"><span class="tag">&lt;<span class="title">validators</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">validator</span> <span class="attribute">name</span>=<span class="value">"idCard"</span> <span class="attribute">class</span>=<span class="value">"section09.IDCardValidator"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">validators</span>&gt;</span></div></pre></td></tr></table></figure>

<p>配置完成后就可以像系统默认的验证器那样使用。例如下面是声明使用身份证校验器的方法：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">validators</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="title">field</span> <span class="attribute">name</span>=<span class="value">"idCard"</span>&gt;</span></div><div class="line">         <span class="tag">&lt;<span class="title">field-validator</span> <span class="attribute">type</span>=<span class="value">"idCard"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="title">param</span> <span class="attribute">name</span>=<span class="value">"length"</span>&gt;</span>18<span class="tag">&lt;/<span class="title">param</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="title">message</span>&gt;</span>not a valid id<span class="tag">&lt;/<span class="title">message</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="title">field-validator</span>&gt;</span></div><div class="line">     <span class="tag">&lt;/<span class="title">field</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">validators</span>&gt;</span></div></pre></td></tr></table></figure>

  
	</div>
		<footer class="article-footer clearfix">

  <div class="article-tags">
  
  <span></span> <a href="/tags/Struts2/">Struts2</a>
  </div>




<div class="article-share" id="share">

  <div data-url="http://yoursite.com/2015/04/27/Java/Struts2/Struts2完全教程（4）- 类型转换和国际化/" data-title="Struts2完全教程（4）- 类型转换和国际化 | LC的笔记" data-tsina="null" class="share clearfix">
  </div>

</div>
</footer>   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2015/04/27/Java/Struts2/Struts2完全教程（5）- 文件上传下载，表单重复提交和自定义拦截器/" title="Struts2完全教程（5）- 文件上传下载，表单重复提交和自定义拦截器">
  <strong>PREVIOUS:</strong><br/>
  <span>
  Struts2完全教程（5）- 文件上传下载，表单重复提交和自定义拦截器</span>
</a>
</div>


<div class="next">
<a href="/2015/04/27/Android/Android完全教程（三）：持久化-保存数据到SQLite/"  title="Android完全教程（三）：持久化-保存数据到SQLite">
 <strong>NEXT:</strong><br/> 
 <span>Android完全教程（三）：持久化-保存数据到SQLite
</span>
</a>
</div>

</nav>

	
</div>  
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">Contents</strong>
  <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#类型转换"><span class="toc-number">1.</span> <span class="toc-text">类型转换</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#类型转换失败"><span class="toc-number">1.1.</span> <span class="toc-text">类型转换失败</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#类型转换错误消息的定制"><span class="toc-number">1.2.</span> <span class="toc-text">类型转换错误消息的定制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义类型转换器"><span class="toc-number">1.3.</span> <span class="toc-text">自定义类型转换器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#复杂Model对象和表单的映射"><span class="toc-number">2.</span> <span class="toc-text">复杂Model对象和表单的映射</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#属性为JavaBean的Model"><span class="toc-number">2.1.</span> <span class="toc-text">属性为JavaBean的Model</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#属性为集合的Model"><span class="toc-number">2.2.</span> <span class="toc-text">属性为集合的Model</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#负责属性的类型转换问题"><span class="toc-number">2.3.</span> <span class="toc-text">负责属性的类型转换问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#国际化"><span class="toc-number">3.</span> <span class="toc-text">国际化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#配置国际化资源文件"><span class="toc-number">3.1.</span> <span class="toc-text">配置国际化资源文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#访问国际化消息"><span class="toc-number">3.2.</span> <span class="toc-text">访问国际化消息</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#不带占位符"><span class="toc-number">3.2.1.</span> <span class="toc-text">不带占位符</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#带占位符"><span class="toc-number">3.2.2.</span> <span class="toc-text">带占位符</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用超链接_实现动态加载国际化资源文件"><span class="toc-number">3.3.</span> <span class="toc-text">使用超链接 实现动态加载国际化资源文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#i18n拦截器的执行原理"><span class="toc-number">3.4.</span> <span class="toc-text">i18n拦截器的执行原理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#输入验证"><span class="toc-number">4.</span> <span class="toc-text">输入验证</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#声明式验证"><span class="toc-number">4.1.</span> <span class="toc-text">声明式验证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#显示验证错误消息"><span class="toc-number">4.2.</span> <span class="toc-text">显示验证错误消息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#错误消息国际化"><span class="toc-number">4.3.</span> <span class="toc-text">错误消息国际化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#短路验证"><span class="toc-number">4.4.</span> <span class="toc-text">短路验证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#验证和类型转换的问题"><span class="toc-number">4.5.</span> <span class="toc-text">验证和类型转换的问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#非字段验证"><span class="toc-number">4.6.</span> <span class="toc-text">非字段验证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#不同的属性使用相同的验证消息"><span class="toc-number">4.7.</span> <span class="toc-text">不同的属性使用相同的验证消息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义验证器"><span class="toc-number">4.8.</span> <span class="toc-text">自定义验证器</span></a></li></ol></li></ol>
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">

  

  
<div class="tagslist">
	<p class="asidetitle">Tags</p>
		<ul class="clearfix">
		
			<li><a href="/tags/Android/" title="Android">Android<sup>3</sup></a></li>
		
			<li><a href="/tags/Concurrent/" title="Concurrent">Concurrent<sup>7</sup></a></li>
		
			<li><a href="/tags/ConcurrentAPI/" title="ConcurrentAPI">ConcurrentAPI<sup>1</sup></a></li>
		
			<li><a href="/tags/Cookie-Session/" title="Cookie&amp;Session">Cookie&amp;Session<sup>2</sup></a></li>
		
			<li><a href="/tags/Hibernate/" title="Hibernate">Hibernate<sup>5</sup></a></li>
		
			<li><a href="/tags/JDBC/" title="JDBC">JDBC<sup>3</sup></a></li>
		
			<li><a href="/tags/JSP-Servlet/" title="JSP&amp;Servlet">JSP&amp;Servlet<sup>5</sup></a></li>
		
			<li><a href="/tags/Java/" title="Java">Java<sup>3</sup></a></li>
		
			<li><a href="/tags/Maven/" title="Maven">Maven<sup>4</sup></a></li>
		
			<li><a href="/tags/MyBatis/" title="MyBatis">MyBatis<sup>2</sup></a></li>
		
			<li><a href="/tags/NIO/" title="NIO">NIO<sup>6</sup></a></li>
		
			<li><a href="/tags/Network/" title="Network">Network<sup>2</sup></a></li>
		
			<li><a href="/tags/Oracle/" title="Oracle">Oracle<sup>6</sup></a></li>
		
			<li><a href="/tags/SQL/" title="SQL">SQL<sup>6</sup></a></li>
		
			<li><a href="/tags/Spring/" title="Spring">Spring<sup>5</sup></a></li>
		
			<li><a href="/tags/SpringMVC/" title="SpringMVC">SpringMVC<sup>4</sup></a></li>
		
			<li><a href="/tags/Struts2/" title="Struts2">Struts2<sup>5</sup></a></li>
		
			<li><a href="/tags/设计模式/" title="设计模式">设计模式<sup>12</sup></a></li>
		
		</ul>
</div>


  <div class="rsspart">
	<a href="null" target="_blank" title="rss">RSS</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<div class="social-font clearfix">
		
		
		
		
		
	</div>
		<p class="copyright">Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/A-limon/pacman" target="_blank" title="Pacman">Pacman</a> © 2015 
		
		<a href="http://yoursite.com" target="_blank" title="zlc">zlc</a>
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    o.click(function(){
      ta.css('display', 'none');
    });
    $(window).scroll(function(){
      ta.css("top",Math.max(140,320-$(this).scrollTop()));
    });
  };
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});     
</script>






  </body>
</html>
