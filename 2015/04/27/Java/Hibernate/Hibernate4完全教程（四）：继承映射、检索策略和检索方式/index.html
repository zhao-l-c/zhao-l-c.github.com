
 <!DOCTYPE HTML>
<html lang="zh-cn">
<head>
  <meta charset="UTF-8">
  
    <title>LC的笔记</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
    
    <meta name="author" content="zlc">
    
    <meta name="description" content="title:Hibernate4完全教程（四）：继承映射、检索策略和检索方式date:Mon Apr 27 18:27:55 CST 2015
tags:[hibernate]
继承映射
当两个JavaBean的关系是继承关系，这时候需要保存父类和子类的对象，这就是继承映射。
Hibernate支持">
    
    
    
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/pacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/pacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">

</head>

  <body>
    <header>
      <div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.svg" alt="LC的笔记" title="LC的笔记"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="LC的笔记">LC的笔记</a></h1>
				<h2 class="blog-motto">好记性不如烂笔头</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
					<li>
					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="text" id="search" name="q" autocomplete="off" maxlength="20" placeholder="Search" />
						<input type="hidden" name="q" value="site:yoursite.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>

    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/04/27/Java/Hibernate/Hibernate4完全教程（四）：继承映射、检索策略和检索方式/" title="" itemprop="url"></a>
  </h1>
  <p class="article-author">By
    
      <a href="http://yoursite.com" title="zlc">zlc</a>
    </p>
  <p class="article-time">
    <time datetime="2015-04-27T10:29:02.000Z" itemprop="datePublished">4月 27 2015</time>
    Updated:<time datetime="2015-04-27T10:27:55.000Z" itemprop="dateModified">4月 27 2015</time>
    
  </p>
</header>
	<div class="article-content">
		
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">Contents</strong>
		<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#tags:[hibernate]"><span class="toc-number">1.</span> <span class="toc-text">tags:[hibernate]</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#继承映射"><span class="toc-number">2.</span> <span class="toc-text">继承映射</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#使用subclass"><span class="toc-number">2.1.</span> <span class="toc-text">使用subclass</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用joined-subclass"><span class="toc-number">2.2.</span> <span class="toc-text">使用joined-subclass</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用union-subclass"><span class="toc-number">2.3.</span> <span class="toc-text">使用union-subclass</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#检索策略"><span class="toc-number">3.</span> <span class="toc-text">检索策略</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#class元素的lazy属性作用"><span class="toc-number">3.1.</span> <span class="toc-text">class元素的lazy属性作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#set元素的lazy属性作用"><span class="toc-number">3.2.</span> <span class="toc-text">set元素的lazy属性作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#set元素的batch-size属性"><span class="toc-number">3.3.</span> <span class="toc-text">set元素的batch-size属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#set元素的fetch属性"><span class="toc-number">3.4.</span> <span class="toc-text">set元素的fetch属性</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Hibernate检索方式"><span class="toc-number">4.</span> <span class="toc-text">Hibernate检索方式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#HQL"><span class="toc-number">4.1.</span> <span class="toc-text">HQL</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#绑定参数"><span class="toc-number">4.1.1.</span> <span class="toc-text">绑定参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HQL分页查询"><span class="toc-number">4.1.2.</span> <span class="toc-text">HQL分页查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HQL命名SQL语句"><span class="toc-number">4.1.3.</span> <span class="toc-text">HQL命名SQL语句</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#投影查询"><span class="toc-number">4.1.4.</span> <span class="toc-text">投影查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#报表查询"><span class="toc-number">4.1.5.</span> <span class="toc-text">报表查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#左外连接和迫切左外连接"><span class="toc-number">4.1.6.</span> <span class="toc-text">左外连接和迫切左外连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#内连接和迫切内连接"><span class="toc-number">4.1.7.</span> <span class="toc-text">内连接和迫切内连接</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#QBC"><span class="toc-number">4.2.</span> <span class="toc-text">QBC</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#原生SQL"><span class="toc-number">4.3.</span> <span class="toc-text">原生SQL</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#使用自定义的结果转换器处理查询结果：_setResultTransformer"><span class="toc-number">4.3.1.</span> <span class="toc-text">使用自定义的结果转换器处理查询结果： setResultTransformer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#使用标量"><span class="toc-number">4.3.2.</span> <span class="toc-text">使用标量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#实体查询：addEntity"><span class="toc-number">4.3.3.</span> <span class="toc-text">实体查询：addEntity</span></a></li></ol></li></ol></li></ol>
		</div>
		
		<p>title:Hibernate4完全教程（四）：继承映射、检索策略和检索方式<br>date:Mon Apr 27 18:27:55 CST 2015</p>
<h2 id="tags:[hibernate]">tags:[hibernate]</h2>
<h2 id="继承映射">继承映射</h2>
<p>当两个JavaBean的关系是继承关系，这时候需要保存父类和子类的对象，这就是继承映射。</p>
<p>Hibernate支持三种继承映射策略：</p>
<ul>
<li>使用 subclass 进行映射：将父类和子类对象都<strong>映射到一个独立的表中</strong>；</li>
<li>使用 joined-subclass 进行映射： 父类对象映射到独立的表中，而子类对象中继承于父类的部分也映射到父类的表中，非继承部分则映射到自己独立的表中；</li>
<li>使用  union-subclass 进行映射：域模型中的每个类映射到一个表，通过关系数据模型中的外键来描述表之间的继承关系。这也就相当于按照域模型的结构来建立数据库中的表，并通过外键来建立表之间的继承关系。</li>
</ul>
<p><strong>使用这3种方法进行映射的特点是都只需要配置一个映射文件，一般是配置父类的映射文件，然后在class元素中配置子类的子元素！</strong></p>
<p>下面的测试示例中都是使用父类Person和它的子类Student进行的：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>{</div><div class="line">    <span class="keyword">private</span> Integer id;</div><div class="line">    <span class="keyword">private</span> String name;</div><div class="line">    <span class="keyword">private</span> Integer age;</div><div class="line">    <span class="comment">// getter setter</span></div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="keyword">extends</span> <span class="title">Person</span> </span>{</div><div class="line">    <span class="keyword">private</span> String school;</div><div class="line">    <span class="comment">// getter setter</span></div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="使用subclass">使用subclass</h3>
<p>Person的映射文件内容为：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">hibernate-mapping</span> <span class="attribute">package</span>=<span class="value">"section05.subclass"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">class</span> <span class="attribute">name</span>=<span class="value">"Person"</span> <span class="attribute">table</span>=<span class="value">"PERSON_STUDENT"</span> <span class="attribute">discriminator-value</span>=<span class="value">"isPerson"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="title">id</span> <span class="attribute">name</span>=<span class="value">"id"</span> <span class="attribute">type</span>=<span class="value">"java.lang.Integer"</span> <span class="attribute">column</span>=<span class="value">"ID"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="title">generator</span> <span class="attribute">class</span>=<span class="value">"native"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="title">id</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!-- 辨别列，一定要在其他列前面定义 --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="title">discriminator</span> <span class="attribute">column</span>=<span class="value">"WHICH_ONE"</span> <span class="attribute">type</span>=<span class="value">"java.lang.String"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"name"</span> <span class="attribute">type</span>=<span class="value">"java.lang.String"</span> <span class="attribute">column</span>=<span class="value">"NAME"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"age"</span> <span class="attribute">type</span>=<span class="value">"java.lang.Integer"</span> <span class="attribute">column</span>=<span class="value">"AGE"</span>/&gt;</span></div><div class="line">        <span class="comment">&lt;!-- 子类特有的列 --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="title">subclass</span> <span class="attribute">name</span>=<span class="value">"Student"</span> <span class="attribute">discriminator-value</span>=<span class="value">"isStudent"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"school"</span> <span class="attribute">type</span>=<span class="value">"java.lang.String"</span> <span class="attribute">column</span>=<span class="value">"SCHOOL"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="title">subclass</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="title">class</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">hibernate-mapping</span>&gt;</span></div></pre></td></tr></table></figure>

<p>配置时需要注意几点：</p>
<ul>
<li>需要配置<strong>discriminator</strong>元素，添加一个辨别字段，字段名自定义，一般是String类型的。辨别字段由Hibernate自动维护；</li>
<li>父类的class和子类的subclass元素都需要配置<strong>discriminator-value</strong>值，这个值是用来插入到辨别字段中的；</li>
<li>subclass是映射子类中独有的属性；</li>
<li><strong>所有子类独有的字段都不能有非空约束</strong>，因为子类独有的字段也是在同一张表中，所以对于父类来说这个字段一定只能为null。</li>
</ul>
<p>生成的数据库表只有一张，结构为：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">| person_studnet | <span class="operator"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`person_student`</span> (</span></div><div class="line">  <span class="string">`ID`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> auto_increment,</div><div class="line">  <span class="string">`WHICH_ONE`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</div><div class="line">  <span class="string">`NAME`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">default</span> <span class="literal">NULL</span>,</div><div class="line">  <span class="string">`AGE`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">default</span> <span class="literal">NULL</span>,</div><div class="line">  <span class="string">`SCHOOL`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">default</span> <span class="literal">NULL</span>,</div><div class="line">  <span class="keyword">PRIMARY</span> <span class="keyword">KEY</span>  (<span class="string">`ID`</span>)</div><div class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">3</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8 |</div></pre></td></tr></table></figure>

<p>测试插入和查询功能：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 子类和父类数据都插入到同一张表中                                      </span></div><div class="line">@Test                                                    </div><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSave</span>() {                                 </div><div class="line">    Person p = <span class="keyword">new</span> Person(<span class="keyword">null</span>, <span class="string">"hehe"</span>, <span class="number">20</span>);             </div><div class="line">    session.save(p);                                     </div><div class="line"> </div><div class="line">    Student s = <span class="keyword">new</span> Student(<span class="keyword">null</span>, <span class="string">"xixi"</span>, <span class="number">20</span>, <span class="string">"THU"</span>);    </div><div class="line">    session.save(s);                                     </div><div class="line">}                                                        </div><div class="line"> </div><div class="line"><span class="comment">// 查询都是从同一个表中获取                                          </span></div><div class="line">@Test                                                    </div><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGet</span>() {                                  </div><div class="line">    Person p = (Person)session.<span class="keyword">get</span>(Person.class, <span class="number">1</span>);     </div><div class="line">    System.<span class="keyword">out</span>.println(p.getName());                     </div><div class="line"> </div><div class="line">    Student s = (Student) session.<span class="keyword">get</span>(Student.class, <span class="number">2</span>); </div><div class="line">    System.<span class="keyword">out</span>.println(s.getSchool());                   </div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="使用joined-subclass">使用joined-subclass</h3>
<p>此时Person的映射文件内容为：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">hibernate-mapping</span> <span class="attribute">package</span>=<span class="value">"section05.join_subclass"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">class</span> <span class="attribute">name</span>=<span class="value">"Person"</span> <span class="attribute">table</span>=<span class="value">"PERSONS"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="title">id</span> <span class="attribute">name</span>=<span class="value">"id"</span> <span class="attribute">type</span>=<span class="value">"java.lang.Integer"</span> <span class="attribute">column</span>=<span class="value">"ID"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="title">generator</span> <span class="attribute">class</span>=<span class="value">"native"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="title">id</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"name"</span> <span class="attribute">type</span>=<span class="value">"java.lang.String"</span> <span class="attribute">column</span>=<span class="value">"NAME"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"age"</span> <span class="attribute">type</span>=<span class="value">"java.lang.Integer"</span> <span class="attribute">column</span>=<span class="value">"AGE"</span>/&gt;</span></div><div class="line"> </div><div class="line">        <span class="tag">&lt;<span class="title">joined-subclass</span> <span class="attribute">name</span>=<span class="value">"Student"</span> <span class="attribute">table</span>=<span class="value">"STUDENTS"</span>&gt;</span></div><div class="line">            <span class="comment">&lt;!-- 声明外键，引用父表的主键 --&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="title">key</span> <span class="attribute">column</span>=<span class="value">"FK_PERSON_ID"</span> <span class="attribute">foreign-key</span>=<span class="value">"ID"</span>/&gt;</span></div><div class="line">            <span class="comment">&lt;!-- 可以添加非空约束 --&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"school"</span> <span class="attribute">column</span>=<span class="value">"SCHOOL"</span> <span class="attribute">not-null</span>=<span class="value">"true"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="title">joined-subclass</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="title">class</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">hibernate-mapping</span>&gt;</span></div></pre></td></tr></table></figure>

<p>注意几点：</p>
<ul>
<li>不需要辨别字段，父类实例数据保存在父类表中，子类实例由父类表和子类表共同存储；</li>
<li>使用joined-subclass映射子类的属性，而且<strong>必须使用key元素映射声明一个外键，引用的是父表的主键</strong>。这样才能把子类的数据分散到父表和字表中存储并通过外键索引；</li>
<li>子类对象的属性可以声明<strong>非空的</strong>，因为这些属性保存到独立的字表中。</li>
</ul>
<p>这时候生成的数据表有2个，分别为父表和字表，结构为：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">| persons | <span class="operator"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`persons`</span> (</span></div><div class="line">  <span class="string">`ID`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> auto_increment,</div><div class="line">  <span class="string">`NAME`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">default</span> <span class="literal">NULL</span>,</div><div class="line">  <span class="string">`AGE`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">default</span> <span class="literal">NULL</span>,</div><div class="line">  <span class="keyword">PRIMARY</span> <span class="keyword">KEY</span>  (<span class="string">`ID`</span>)</div><div class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">3</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8 |</div><div class="line"></div><div class="line"></div><div class="line">| students | <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`students`</span> (</div><div class="line">  <span class="string">`FK_PERSON_ID`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</div><div class="line">  <span class="string">`SCHOOL`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</div><div class="line">  <span class="keyword">PRIMARY</span> <span class="keyword">KEY</span>  (<span class="string">`FK_PERSON_ID`</span>),</div><div class="line">  <span class="keyword">KEY</span> <span class="string">`ID`</span> (<span class="string">`FK_PERSON_ID`</span>),</div><div class="line">  <span class="keyword">CONSTRAINT</span> <span class="string">`ID`</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (<span class="string">`FK_PERSON_ID`</span>) <span class="keyword">REFERENCES</span> <span class="string">`persons`</span> (<span class="string">`ID`</span>)</div><div class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8 |</div></pre></td></tr></table></figure>

<p><strong>字表中除了子类属性对应的字段外，就是引用父表主键的外键字段了。</strong></p>
<p>测试保存和查询功能：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*                                                          </span></div><div class="line"> * 父类直接保存在父类的表中；                                            </div><div class="line"> * 子类需要保存到父类的表中和自己的数据表中。                                    </div><div class="line"> */                                                         </div><div class="line">@Test                                                       </div><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSave</span>() {                                    </div><div class="line">    Person p = <span class="keyword">new</span> Person(<span class="keyword">null</span>, <span class="string">"hehe"</span>, <span class="number">20</span>);                </div><div class="line">    session.save(p);                                        </div><div class="line"> </div><div class="line">    Student s = <span class="keyword">new</span> Student(<span class="keyword">null</span>, <span class="string">"xixi"</span>, <span class="number">20</span>, <span class="string">"THU"</span>);       </div><div class="line">    session.save(s);                                        </div><div class="line">}                                                           </div><div class="line"> </div><div class="line"><span class="comment">/*                                                          </span></div><div class="line"> * 查询:                                                      </div><div class="line"> * 1. 查询父类记录, 做一个左外连接查询；                                    </div><div class="line"> * 2. 对于子类记录, 做一个内连接查询。                                     </div><div class="line"> */                                                         </div><div class="line">@Test                                                       </div><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGet</span>() {                                     </div><div class="line">    Person p = (Person)session.<span class="keyword">get</span>(Person.class, <span class="number">1</span>);        </div><div class="line">    System.<span class="keyword">out</span>.println(p.getName());                        </div><div class="line"> </div><div class="line">    Student s = (Student) session.<span class="keyword">get</span>(Student.class, <span class="number">2</span>);    </div><div class="line">    System.<span class="keyword">out</span>.println(s.getSchool());                      </div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="使用union-subclass">使用union-subclass</h3>
<p>此时Person的映射文件为：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&lt;hibernate-mapping <span class="variable">package=</span><span class="string">"section05.union_subclass"</span>&gt;</div><div class="line">    &lt;class <span class="variable">name=</span><span class="string">"Person"</span> <span class="variable">table=</span><span class="string">"PERSONS"</span>&gt;</div><div class="line">        &lt;id <span class="variable">name=</span><span class="string">"id"</span> <span class="variable">type=</span><span class="string">"java.lang.Integer"</span> <span class="variable">column=</span><span class="string">"ID"</span>&gt;</div><div class="line">            &lt;generator <span class="variable">class=</span><span class="string">"hilo"</span>/&gt;</div><div class="line">        &lt;/id&gt;</div><div class="line">        &lt;property <span class="variable">name=</span><span class="string">"name"</span> <span class="variable">type=</span><span class="string">"java.lang.String"</span> <span class="variable">column=</span><span class="string">"NAME"</span>/&gt;</div><div class="line">        &lt;property <span class="variable">name=</span><span class="string">"age"</span> <span class="variable">type=</span><span class="string">"java.lang.Integer"</span> <span class="variable">column=</span><span class="string">"AGE"</span>/&gt;</div><div class="line"> </div><div class="line">        &lt;union-subclass <span class="variable">name=</span><span class="string">"Student"</span> <span class="variable">table=</span><span class="string">"STUDENTS"</span>&gt;</div><div class="line">            &lt;property <span class="variable">name=</span><span class="string">"school"</span> <span class="variable">column=</span><span class="string">"SCHOOL"</span> <span class="variable">type=</span><span class="string">"java.lang.String"</span>/&gt;</div><div class="line">        &lt;/union-subclass&gt;</div><div class="line">    &lt;/class&gt;</div><div class="line">&lt;/hibernate-mapping&gt;</div></pre></td></tr></table></figure>

<p>注意几点：</p>
<ul>
<li>父类和子类对象的数据会分别存储在各自的表中，所以<strong>子类的表</strong>会比父类的表有更多的字段；</li>
<li>这时候不需要辨别字段和外键，只需要用<strong>union-subclass</strong>映射子类的属性即可；</li>
<li>同样子类的属性可以定义为非空约束的字段；</li>
<li><strong>一定要注意，父类的OID生成策略一定不能为identity或者native</strong>，可以用hilo等。相关的代码为：</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// UnionSubclassEntityPersister 构造函数</span></div><div class="line"><span class="keyword">public</span> <span class="title">UnionSubclassEntityPersister</span>(                                                              </div><div class="line">        <span class="keyword">final</span> PersistentClass persistentClass,                                                    </div><div class="line">        <span class="keyword">final</span> EntityRegionAccessStrategy cacheAccessStrategy,                                     </div><div class="line">        <span class="keyword">final</span> NaturalIdRegionAccessStrategy naturalIdRegionAccessStrategy,                        </div><div class="line">        <span class="keyword">final</span> SessionFactoryImplementor factory,                                                  </div><div class="line">        <span class="keyword">final</span> Mapping mapping) <span class="keyword">throws</span> HibernateException {                                        </div><div class="line"> </div><div class="line">    <span class="keyword">super</span>( persistentClass, cacheAccessStrategy, naturalIdRegionAccessStrategy, factory );        </div><div class="line">    <span class="comment">// 生成器不能是 IdentityGenerator类型的</span></div><div class="line">    <span class="keyword">if</span> ( getIdentifierGenerator() <span class="keyword">instanceof</span> IdentityGenerator ) {                                </div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> MappingException(                                                               </div><div class="line">                <span class="string">"Cannot use identity column key generation with &lt;union-subclass&gt; mapping for: "</span> + </div><div class="line">                getEntityName()                                                                   </div><div class="line">        );                                                                                        </div><div class="line">    }</div></pre></td></tr></table></figure>

<p>此时生成的数据表也是有2个，分别是父表和字表，结构为：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">| persons | <span class="operator"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`persons`</span> (</span></div><div class="line">  <span class="string">`ID`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</div><div class="line">  <span class="string">`NAME`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">default</span> <span class="literal">NULL</span>,</div><div class="line">  <span class="string">`AGE`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">default</span> <span class="literal">NULL</span>,</div><div class="line">  <span class="keyword">PRIMARY</span> <span class="keyword">KEY</span>  (<span class="string">`ID`</span>)</div><div class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8 |</div><div class="line"></div><div class="line"></div><div class="line">| students | <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`students`</span> (</div><div class="line">  <span class="string">`ID`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</div><div class="line">  <span class="string">`NAME`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">default</span> <span class="literal">NULL</span>,</div><div class="line">  <span class="string">`AGE`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">default</span> <span class="literal">NULL</span>,</div><div class="line">  <span class="string">`SCHOOL`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">default</span> <span class="literal">NULL</span>,</div><div class="line">  <span class="keyword">PRIMARY</span> <span class="keyword">KEY</span>  (<span class="string">`ID`</span>)</div><div class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8 |</div></pre></td></tr></table></figure>

<p><strong>字表此时包含了父表中的字段。</strong></p>
<p>测试保存和查询功能：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*                                                                         </span></div><div class="line"> * 父类直接保存在父类的表中；                                                           </div><div class="line"> * 子类也是直接保存到字表中。                                                           </div><div class="line"> */                                                                        </div><div class="line">@Test                                                                      </div><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSave</span>() {                                                   </div><div class="line">    Person p = <span class="keyword">new</span> Person(<span class="keyword">null</span>, <span class="string">"hehe"</span>, <span class="number">20</span>);                               </div><div class="line">    session.save(p);                                                       </div><div class="line"> </div><div class="line">    Student s = <span class="keyword">new</span> Student(<span class="keyword">null</span>, <span class="string">"xixi"</span>, <span class="number">20</span>, <span class="string">"THU"</span>);                      </div><div class="line">    session.save(s);                                                       </div><div class="line">}                                                                          </div><div class="line"> </div><div class="line"><span class="comment">/*                                                                         </span></div><div class="line"> * 查询:                                                                     </div><div class="line"> * 查询父类记录, 需把父表和子表记录unio为一张数据表，然后再查询. 性能稍差.                                </div><div class="line"> * 对于子类记录, 也只需要查询一张数据表                                                     </div><div class="line"> */                                                                        </div><div class="line">@Test                                                                      </div><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGet</span>() {                                                    </div><div class="line">    Person p = (Person)session.<span class="keyword">get</span>(Person.class, <span class="number">1</span>);                       </div><div class="line">    System.<span class="keyword">out</span>.println(p.getName());                                       </div><div class="line"> </div><div class="line">    Student s = (Student) session.<span class="keyword">get</span>(Student.class, <span class="number">2</span>);                   </div><div class="line">    System.<span class="keyword">out</span>.println(s.getSchool());                                     </div><div class="line">}</div></pre></td></tr></table></figure>

<hr>
<h2 id="检索策略">检索策略</h2>
<blockquote>
<p>注意，下面的示例都是在前面介绍的双向一对多的映射关系下测试的，此时JavaBean为：</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> Customer {</div><div class="line">    <span class="keyword">private</span> Integer customerId;</div><div class="line">    <span class="keyword">private</span> String customerName;</div><div class="line">    <span class="comment">// 一对多属性</span></div><div class="line">    <span class="keyword">private</span> Set&lt;Order&gt; orders = <span class="keyword">new</span> HashSet&lt;&gt;();</div><div class="line">    <span class="comment">// getter setter</span></div><div class="line">}</div><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> Order {</div><div class="line">    <span class="keyword">private</span> Integer orderId;</div><div class="line">    <span class="keyword">private</span> String orderName;</div><div class="line">    <span class="comment">// 多对一引用属性</span></div><div class="line">    <span class="keyword">private</span> Customer customer;</div><div class="line">    <span class="comment">// getter setter</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p>映射文件分别为：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">// Customer对象</div><div class="line">&lt;hibernate-mapping <span class="variable">package=</span><span class="string">"section06"</span>&gt;</div><div class="line">    &lt;class <span class="variable">name=</span><span class="string">"Customer"</span> <span class="variable">table=</span><span class="string">"CUSTOMERS"</span>&gt;</div><div class="line">        &lt;id <span class="variable">name=</span><span class="string">"customerId"</span> <span class="variable">column=</span><span class="string">"CUSTOMER_ID"</span> <span class="variable">type=</span><span class="string">"java.lang.Integer"</span>&gt;</div><div class="line">            &lt;generator <span class="variable">class=</span><span class="string">"native"</span>/&gt;</div><div class="line">        &lt;/id&gt;</div><div class="line">        &lt;property <span class="variable">name=</span><span class="string">"customerName"</span> <span class="variable">column=</span><span class="string">"CUSTOMER_NAME"</span> <span class="variable">type=</span><span class="string">"java.lang.String"</span>/&gt;</div><div class="line">        &lt;set <span class="variable">name=</span><span class="string">"orders"</span> <span class="variable">table=</span><span class="string">"CUSTOMERS"</span> <span class="variable">inverse=</span><span class="string">"true"</span> &gt;</div><div class="line">            &lt;key <span class="variable">column=</span><span class="string">"FK_CUSTOMER_ID"</span>/&gt;</div><div class="line">            &lt;one-to-many <span class="variable">class=</span><span class="string">"Order"</span>/&gt;</div><div class="line">        &lt;/set&gt;</div><div class="line">    &lt;/class&gt;</div><div class="line">&lt;/hibernate-mapping&gt;</div><div class="line">// Order对象</div><div class="line">&lt;hibernate-mapping <span class="variable">package=</span><span class="string">"section06"</span>&gt;</div><div class="line">    &lt;class <span class="variable">name=</span><span class="string">"Order"</span> <span class="variable">table=</span><span class="string">"ORDERS"</span>&gt;</div><div class="line">        &lt;id <span class="variable">name=</span><span class="string">"orderId"</span> <span class="variable">column=</span><span class="string">"ORDER_ID"</span> <span class="variable">type=</span><span class="string">"java.lang.Integer"</span>&gt;</div><div class="line">            &lt;generator <span class="variable">class=</span><span class="string">"native"</span>/&gt;</div><div class="line">        &lt;/id&gt;</div><div class="line">        &lt;property <span class="variable">name=</span><span class="string">"orderName"</span> <span class="variable">column=</span><span class="string">"ORDER_NAME"</span> <span class="variable">type=</span><span class="string">"java.lang.String"</span>/&gt;</div><div class="line">        &lt;many-to-one <span class="variable">name=</span><span class="string">"customer"</span> <span class="variable">class=</span><span class="string">"Customer"</span> <span class="variable">column=</span><span class="string">"FK_CUSTOMER_ID"</span> <span class="variable">foreign-key=</span><span class="string">"CUSTOMER_ID"</span>/&gt;</div><div class="line">    &lt;/class&gt;</div><div class="line">&lt;/hibernate-mapping&gt;</div></pre></td></tr></table></figure>

<p>下面会分别介绍class元素的lazy属性和set元素的lazy、batch-size和fetch属性的效果。</p>
<p>检索策略有2种：</p>
<ul>
<li>立即检索： 立即加载检索方法指定的对象的属性数据，一般是非引用类型的数据；</li>
</ul>
<ul>
<li>延迟检索： 延迟加载检索方法指定的对象的引用类型数据，在使用具体的属性时，再进行加载。</li>
</ul>
<p>延迟加载的检索方式一般通过<strong>lazy</strong>属性进行设置，可以在class元素或者set元素中设置这个属性。</p>
<p><strong>注意，检索策略还跟查询的方法有关，即无论lazy的值为true还是false，但<code>Session</code>的<code>get</code>和<code>Query</code>的<code>list</code>方法都是使用立即检索的方式！</strong></p>
<p>下面分别介绍lazy属性在class和set中的作用。</p>
<h3 id="class元素的lazy属性作用">class元素的lazy属性作用</h3>
<p>class元素的 lazy 属性为<strong>true</strong>（默认值就是为true），<code>Session</code>的<strong><code>load</code></strong>方法不会执行查询数据表的 SELECT 语句，仅返回代理类对象的实例，该代理类实例有如下特征：</p>
<ul>
<li>由 Hibernate 在运行时采用 CGLIB 工具动态生成；</li>
<li>Hibernate 创建代理类实例时仅初始化其 OID 属性；</li>
<li>在应用程序第一次访问代理类实例的非 OID 属性时，Hibernate 会初始化代理类实例。</li>
</ul>
<p>示例：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testLoad</span>() {                                            </div><div class="line">    Customer customer = (Customer) session.load(Customer.class, <span class="number">1</span>);</div><div class="line">    <span class="comment">// 输出对象的class或者OID都不会实例化对象                                     </span></div><div class="line">    System.<span class="keyword">out</span>.println(customer.getClass());                       </div><div class="line">    System.<span class="keyword">out</span>.println(customer.getCustomerId());                  </div><div class="line">    <span class="comment">// 查询非OID属性是才会实例化对象                                            </span></div><div class="line">    System.<span class="keyword">out</span>.println(customer.getCustomerName());                </div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="set元素的lazy属性作用">set元素的lazy属性作用</h3>
<p>在映射文件中，用set元素来配置一对多关联及多对多关联关系，也就是<strong>类型为集合的属性</strong>。set元素可以取值为false、true（<strong>或proxy</strong>）和extra。 + false：立即实例化对象的所有属性。</p>
<ul>
<li>true或者proxy：延迟实例化集合类型的属性。当调用集合类型的<code>iterator()</code>、<code>size()</code>、<code>isEmpty()</code>和<code>contains()</code>等方法和<code>Hibernate.initialize()</code>静态方法是会初始化集合元素对象的受理。 示例：</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">public <span class="type">void</span> testSetLazy() {                                                          </div><div class="line">    // 这里肯定是立即加载，因为使用了get方法                                                          </div><div class="line">    <span class="type">Customer</span> customer = (<span class="type">Customer</span>) session.get(<span class="type">Customer</span>.class, <span class="number">1</span>);                   </div><div class="line">    // 当lazy=<span class="literal">true</span>时，延迟实例化                                                             </div><div class="line">    <span class="type">System</span>.<span class="keyword">out</span>.println(customer.getOrders().<span class="keyword">iterator</span>().next().getOrderName());       </div><div class="line">}</div></pre></td></tr></table></figure>

<ul>
<li>extra：<strong>增强延迟检索策略</strong>，可以进一步延迟集合代理实例的初始化时机。在调用集合类型的<code>size()</code>、<code>contains()</code>和<code>isEmpty()</code>方法时，Hibernate不会初始化集合类的实例，仅通过特定的SELECT语句查询必要的信息，不会检索所有的记录。 示例：</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSetLazy</span>() {                                                   </div><div class="line">    <span class="comment">// 这里肯定是立即加载，因为使用了get方法                                                   </span></div><div class="line">    Customer customer = (Customer) session.<span class="keyword">get</span>(Customer.class, <span class="number">1</span>);            </div><div class="line">    <span class="comment">// 当lazy=true时，延迟实例化                                                      </span></div><div class="line">    System.<span class="keyword">out</span>.println(customer.getOrders().size());                          </div><div class="line">}</div></pre></td></tr></table></figure>


<p>这里只是获取集合的数量，所有只需要发送SELECT COUNT(*)语句查询数目，并不会把所有的记录都查询并实例化对象！</p>
<h3 id="set元素的batch-size属性">set元素的batch-size属性</h3>
<p>set元素的batch-size属性可以<strong>设定批量检索的数量</strong>，批量检索能减少SELECT语句的数目，提高延迟检索或立即检索的运行性能。</p>
<p>例如下列方法中，查询Customer对象的所有记录，并获取每个Customer的orders集合类型属性：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testBatchSize</span>() {                                                     </div><div class="line">    List&lt;Customer&gt; customers = session.createQuery(<span class="string">"FROM Customer"</span>).list();       </div><div class="line">    System.<span class="keyword">out</span>.println(customers.size());                                         </div><div class="line">    <span class="keyword">for</span>(Customer c : customers) {                                                 </div><div class="line">        System.<span class="keyword">out</span>.println(c.getOrders().size());                                 </div><div class="line">    }                                                                             </div><div class="line">}</div></pre></td></tr></table></figure>

<p>如果没有设置batch-size属性值，则每次查询orders属性值时都需要根据Customer的id查询ORDERS表；<br>Customer对应的数据记录总共为5条，而且设置了batch-size位大于或等于5的值，则这时候首先会一次查询出所有的Customer记录，然后用这些Customer的id使用集合查询的方式查询出所有的ORDERS记录。<br>相关的输出SQL语句为：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 查询出所有的Customer记录</span></div><div class="line">Hibernate:</div><div class="line">    <span class="keyword">select</span></div><div class="line">        customer0_.CUSTOMER_ID <span class="keyword">as</span> CUSTOMER1_0_,</div><div class="line">        customer0_.CUSTOMER_NAME <span class="keyword">as</span> CUSTOMER2_0_</div><div class="line">    <span class="keyword">from</span></div><div class="line">        CUSTOMERS customer0_</div><div class="line"><span class="comment">// 使用Customer的id进行集合查询，即使用in操作符</span></div><div class="line">Hibernate:</div><div class="line">    <span class="keyword">select</span></div><div class="line">        orders0_.FK_CUSTOMER_ID <span class="keyword">as</span> FK_CUSTO3_0_1_,</div><div class="line">        orders0_.ORDER_ID <span class="keyword">as</span> ORDER_ID1_1_1_,</div><div class="line">        orders0_.ORDER_ID <span class="keyword">as</span> ORDER_ID1_1_0_,</div><div class="line">        orders0_.ORDER_NAME <span class="keyword">as</span> ORDER_NA2_1_0_,</div><div class="line">        orders0_.FK_CUSTOMER_ID <span class="keyword">as</span> FK_CUSTO3_1_0_</div><div class="line">    <span class="keyword">from</span></div><div class="line">        ORDERS orders0_</div><div class="line">    <span class="keyword">where</span></div><div class="line">        orders0_.FK_CUSTOMER_ID <span class="keyword">in</span> (</div><div class="line">            ?, ?, ?, ?, ?</div><div class="line">        )</div></pre></td></tr></table></figure>

<h3 id="set元素的fetch属性">set元素的fetch属性</h3>
<p>set元素的fetch属性可以取值为select、subselect和join。它们的作用为：</p>
<ul>
<li>select： 默认值，通过正常的方式来初始化set元素对应的集合类型，即一般分2条SQL，第一次先查询id，然后根据id查询集合元素。测试方法：</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFetch</span>() {                                                 </div><div class="line">    List&lt;Customer&gt; customers = session.createQuery(<span class="string">"FROM Customer"</span>).list();</div><div class="line">    System.<span class="keyword">out</span>.println(customers.size());                                 </div><div class="line">    <span class="keyword">for</span>(Customer c : customers) {                                         </div><div class="line">        System.<span class="keyword">out</span>.println(c.getOrders().size());                         </div><div class="line">    }                                                                     </div><div class="line">}</div></pre></td></tr></table></figure>

<p>这时候每次<strong>batch-size属性是有效的</strong>。如果没有设置batch-size属性，则每次查询orders属性时，都会先查询Customer的id，然后根据id查询orders表对应的记录。</p>
<ul>
<li>subselect： 通过<strong>子查询</strong>的方式来初始化所有的set属性，子查询 作为WHERE子句的IN的条件出现，子查询获取“一方”的所有ID。<br>测试方法：</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFetch</span>() {                                                 </div><div class="line">    List&lt;Customer&gt; customers = session.createQuery(<span class="string">"FROM Customer"</span>).list();</div><div class="line">    System.<span class="keyword">out</span>.println(customers.size());                                 </div><div class="line">    <span class="keyword">for</span>(Customer c : customers) {                                         </div><div class="line">        System.<span class="keyword">out</span>.println(c.getOrders().size());                         </div><div class="line">    }                                                                     </div><div class="line">}</div></pre></td></tr></table></figure>

<p>输出的SQL语句类似：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">Hibernate:</div><div class="line">    <span class="keyword">select</span></div><div class="line">        customer0_.CUSTOMER_ID <span class="keyword">as</span> CUSTOMER1_0_,</div><div class="line">        customer0_.CUSTOMER_NAME <span class="keyword">as</span> CUSTOMER2_0_</div><div class="line">    <span class="keyword">from</span></div><div class="line">        CUSTOMERS customer0_</div><div class="line">Hibernate:</div><div class="line">    <span class="keyword">select</span></div><div class="line">        orders0_.FK_CUSTOMER_ID <span class="keyword">as</span> FK_CUSTO3_0_1_,</div><div class="line">        orders0_.ORDER_ID <span class="keyword">as</span> ORDER_ID1_1_1_,</div><div class="line">        orders0_.ORDER_ID <span class="keyword">as</span> ORDER_ID1_1_0_,</div><div class="line">        orders0_.ORDER_NAME <span class="keyword">as</span> ORDER_NA2_1_0_,</div><div class="line">        orders0_.FK_CUSTOMER_ID <span class="keyword">as</span> FK_CUSTO3_1_0_</div><div class="line">    <span class="keyword">from</span></div><div class="line">        ORDERS orders0_</div><div class="line">    <span class="keyword">where</span></div><div class="line">        orders0_.FK_CUSTOMER_ID <span class="keyword">in</span> (</div><div class="line">            <span class="keyword">select</span></div><div class="line">                customer0_.CUSTOMER_ID</div><div class="line">            <span class="keyword">from</span></div><div class="line">                CUSTOMERS customer0_</div><div class="line">        )</div></pre></td></tr></table></figure>

<p>从第二天输出SQL可以看到，查询orders属性时把Customer的ID作为子查询。<br>注意，<strong>此时lazy属性有效，而batch-size属性无效。</strong></p>
<ul>
<li>join：使用<strong>迫切左外连接</strong>的方式实例化集合类型的属性。所谓<strong>迫切</strong>也就是立即实例化集合元素，所以<strong>lazy</strong>属性此时是无效的。<br>测试方法：</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">public <span class="type">void</span> testFetch2() {                                                              </div><div class="line">    <span class="type">Customer</span> customer = (<span class="type">Customer</span>) session.get(<span class="type">Customer</span>.class, <span class="number">1</span>);                      </div><div class="line">    <span class="type">System</span>.<span class="keyword">out</span>.println(customer.getOrders().<span class="keyword">iterator</span>().next().getOrderName());          </div><div class="line">}</div></pre></td></tr></table></figure>

<p>输出的SQL类似：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">Hibernate:</div><div class="line">    <span class="operator"><span class="keyword">select</span></span></div><div class="line">        customer0_.CUSTOMER_ID <span class="keyword">as</span> CUSTOMER1_0_1_,</div><div class="line">        customer0_.CUSTOMER_NAME <span class="keyword">as</span> CUSTOMER2_0_1_,</div><div class="line">        orders1_.FK_CUSTOMER_ID <span class="keyword">as</span> FK_CUSTO3_0_3_,</div><div class="line">        orders1_.ORDER_ID <span class="keyword">as</span> ORDER_ID1_1_3_,</div><div class="line">        orders1_.ORDER_ID <span class="keyword">as</span> ORDER_ID1_1_0_,</div><div class="line">        orders1_.ORDER_NAME <span class="keyword">as</span> ORDER_NA2_1_0_,</div><div class="line">        orders1_.FK_CUSTOMER_ID <span class="keyword">as</span> FK_CUSTO3_1_0_</div><div class="line">    <span class="keyword">from</span></div><div class="line">        CUSTOMERS customer0_</div><div class="line">    <span class="keyword">left</span> <span class="keyword">outer</span> <span class="keyword">join</span></div><div class="line">        ORDERS orders1_</div><div class="line">            <span class="keyword">on</span> customer0_.CUSTOMER_ID=orders1_.FK_CUSTOMER_ID</div><div class="line">    <span class="keyword">where</span></div><div class="line">        customer0_.CUSTOMER_ID=?</div></pre></td></tr></table></figure>

<p>可以看到使用左外连接的方式获取ORDERS表的记录，这样可以实例化orders集合。<br><strong>注意，这个取值对<code>Query</code>的<code>list()</code>方法无效，它会依旧使用延迟加载的策略。</strong></p>
<hr>
<h2 id="Hibernate检索方式">Hibernate检索方式</h2>
<p>Hibernate 提供了以下几种检索对象的方式：</p>
<ul>
<li>导航对象图检索方式：根据已经加载的对象导航到其他对象。<br>例如通过<code>Session</code>的<code>get</code>方法获取了Customer对象，这个对象包含了Order属性，通过引用就能直接获取Order对象。</li>
</ul>
<ul>
<li>OID检索方式：根据对象的 OID 来检索对象。</li>
</ul>
<p>例如<code>Session</code>的<code>get</code>和<code>load</code>方法。</p>
<ul>
<li>HQL检索方式：使用面向对象的 HQL 查询语言。</li>
</ul>
<ul>
<li>QBC检索方式：使用QBC（Query By Criteria）API 来检索对象，这种 API 封装了基于字符串形式的查询语句，提供了更加面向对象的查询接口。</li>
</ul>
<ul>
<li>原生SQL检索方式：直接执行标准的SQL语句。</li>
</ul>
<p>下面分别介绍HQL、QBC和原生SQL的检索方式。</p>
<h3 id="HQL">HQL</h3>
<p>HQL检索通过<strong><code>Query</code>接口的方法</strong>实现，一般的步骤如下：</p>
<ul>
<li>通过<code>Session</code>的<code>createQuery(String hql)</code>方法创建一个<code>Query</code>对象，它的参数是一个 HQL 查询语句；</li>
<li>HQL语句可以使用<strong>位置绑定*</strong>和<strong>命名绑定</strong>两种方式绑定参数；</li>
<li>调用<code>Query</code>的setXxx方法设置绑定参数值，<strong>绑定的参数还可以是对象</strong>；</li>
<li>调用<code>Query</code>相关方法执行查询语句，而且支持<strong>方法链的风格</strong>调用方法；</li>
</ul>
<p>示例：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="literal">void</span> testQuery() {                                     </div><div class="line">    <span class="comment">// HQL语句                                                  </span></div><div class="line">    <span class="built_in">String</span> hql <span class="subst">=</span> <span class="string">"FROM Employee where salary &gt; ? and dept = ?"</span>;</div><div class="line">    <span class="comment">// 创建Quyer对象                                              </span></div><div class="line">    Query query <span class="subst">=</span> session<span class="built_in">.</span>createQuery(hql);                   </div><div class="line">    <span class="comment">// 设置参数                                                   </span></div><div class="line">    Department dept <span class="subst">=</span> <span class="literal">new</span> Department();                       </div><div class="line">    dept<span class="built_in">.</span>setId(<span class="number">1006</span>);                                         </div><div class="line">    query<span class="built_in">.</span>setInteger(<span class="number">0</span>, <span class="number">6430</span>)                                 </div><div class="line">         <span class="built_in">.</span>setEntity(<span class="number">1</span>, dept);                                 </div><div class="line">    <span class="comment">// 执行查询                                                   </span></div><div class="line">    <span class="built_in">List</span><span class="subst">&lt;</span>Employee<span class="subst">&gt;</span> <span class="built_in">list</span> <span class="subst">=</span> query<span class="built_in">.</span><span class="built_in">list</span>();                       </div><div class="line">    System<span class="built_in">.</span>out<span class="built_in">.</span>println(<span class="built_in">list</span>);                                 </div><div class="line">}</div></pre></td></tr></table></figure>

<p>下面介绍HQL查询中的一些细节</p>
<h4 id="绑定参数">绑定参数</h4>
<p>Hibernate的参数绑定机制依赖于 JDBC API 中的<code>PreparedStatement</code>的预定义 SQL 语句功能。<br>HQL 的参数绑定由两种形式：</p>
<ul>
<li>按参数名字绑定：在 HQL 查询语句中定义命名参数，命名参数以<code>:</code>开头；</li>
<li>按参数位置绑定：在 HQL 查询语句中用<code>?</code>来定义参数位置。</li>
</ul>
<p>相关方法：</p>
<ul>
<li>setEntity()：把参数与一个持久化类绑定；</li>
<li>setParameter()：绑定任意类型的参数，该方法的第三个参数显式指定 Hibernate 映射类型；</li>
<li>setXxx()：绑定特定类型的参数；</li>
</ul>
<p>命名参数和<code>setEntity()</code>方法示例：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testNamedParameter</span>() {                                                     </div><div class="line">    Query query = session.createQuery(<span class="string">"FROM Employee where dept = :dept"</span>);             </div><div class="line">    Department dept = <span class="keyword">new</span> Department();                                                </div><div class="line">    dept.setId(<span class="number">1005</span>);                                                                  </div><div class="line">    List&lt;Employee&gt; employees = query.setEntity(<span class="string">"dept"</span>, dept).list();                   </div><div class="line">    System.<span class="keyword">out</span>.println(employees);                                                     </div><div class="line">}</div></pre></td></tr></table></figure>

<h4 id="HQL分页查询">HQL分页查询</h4>
<p>HQL分页查询可以使用下面2个方法：</p>
<ul>
<li>setFirstResult(int firstResult)：设定从哪一个对象开始检索，参数 firstResult 表示这个对象在查询结果中的索引位置，起始值为0；</li>
<li>setMaxResults(int maxResults)：设定一次最多检索出的对象的数目，在默认情况下，<code>Query</code>和<code>Criteria</code>接口都会检索出查询结果中所有的对象。</li>
</ul>
<p>示例：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPage</span>() {                                  </div><div class="line">    Query query = session.createQuery(<span class="string">"FROM Employee"</span>);   </div><div class="line">    <span class="keyword">int</span> pageNo = <span class="number">2</span>;                                       </div><div class="line">    <span class="keyword">int</span> pageSize = <span class="number">4</span>;                                     </div><div class="line">    <span class="comment">// 设置起始位置和总数                                          </span></div><div class="line">    query.setFirstResult((pageNo - <span class="number">1</span>) * pageSize)         </div><div class="line">         .setMaxResults(pageSize);                        </div><div class="line">    List&lt;Employee&gt; employees = query.list();              </div><div class="line">    System.<span class="keyword">out</span>.println(employees);                        </div><div class="line">}</div></pre></td></tr></table></figure>

<p>在MySQL中输出的SQL语句为：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">Hibernate:</div><div class="line">    <span class="operator"><span class="keyword">select</span></span></div><div class="line">        employee0_.ID <span class="keyword">as</span> ID1_1_,</div><div class="line">        employee0_.NAME <span class="keyword">as</span> NAME2_1_,</div><div class="line">        employee0_.SALARY <span class="keyword">as</span> SALARY3_1_,</div><div class="line">        employee0_.EMAIL <span class="keyword">as</span> EMAIL4_1_,</div><div class="line">        employee0_.DEPT_ID <span class="keyword">as</span> DEPT_ID5_1_</div><div class="line">    <span class="keyword">from</span></div><div class="line">        EMPLOYEES employee0_ <span class="keyword">limit</span> ?,  ?</div></pre></td></tr></table></figure>

<h4 id="HQL命名SQL语句">HQL命名SQL语句</h4>
<p>在映射文件中定义命名查询语句，方法是使用<strong> query</strong>元素用于定义一个 HQL查询语句，它和class元素并列。 在程序中通过<code>Session</code>的<code>getNamedQuery()</code>方法获取查询语句对应的<code>Query</code>对象。 </p>
<p>示例：<br>在映射文件中定义一条命名SQL语句：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">query</span> <span class="attribute">name</span>=<span class="value">"select_employees"</span>&gt;</span>                                                  </div><div class="line">    <span class="cdata">&lt;![CDATA[FROM Employee where salary &gt; :minSalary and salary &lt; :maxSalary]]&gt;</span>  </div><div class="line"><span class="tag">&lt;/<span class="title">query</span>&gt;</span></div></pre></td></tr></table></figure>

<p>测试方法：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testNamedQuery</span>() {                                      </div><div class="line">    Query query = session.getNamedQuery(<span class="string">"select_employees"</span>);        </div><div class="line">    List&lt;Employee&gt; employees = query.setInteger(<span class="string">"minSalary"</span>, <span class="number">6430</span>)  </div><div class="line">                                    .setInteger(<span class="string">"maxSalary"</span>, <span class="number">6440</span>)  </div><div class="line">                                    .list();                        </div><div class="line">    System.<span class="keyword">out</span>.println(employees);                                  </div><div class="line">}</div></pre></td></tr></table></figure>




<h4 id="投影查询">投影查询</h4>
<p>投影查询就是查询结果仅包含实体的部分属性，<strong>通过SELECT关键字实现</strong>。示例：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFieldQuery</span>() {                                                                   </div><div class="line">    String hql = <span class="string">"SELECT e.name, e.email, e.salary, e.dept FROM Employee e where e.dept = :dept"</span>;</div><div class="line">    Department dept = <span class="keyword">new</span> Department();                                                          </div><div class="line">    dept.setId(<span class="number">1005</span>);                                                                            </div><div class="line">    List&lt;Object[]&gt; list = session.createQuery(hql)                                               </div><div class="line">                                 .setEntity(<span class="string">"dept"</span>, dept)                                        </div><div class="line">                                 .list();                                                        </div><div class="line">    <span class="keyword">for</span>(Object[] obj : list) {                                                                   </div><div class="line">        System.<span class="keyword">out</span>.println(obj[<span class="number">0</span>] + <span class="string">"-"</span> + obj[<span class="number">1</span>] + <span class="string">"-"</span> + obj[<span class="number">2</span>] + <span class="string">"-["</span> + obj[<span class="number">3</span>] + <span class="string">"]"</span>);          </div><div class="line">    }                                                                                            </div><div class="line">}</div></pre></td></tr></table></figure>


<p>这时候<code>list()</code>方法返回的类型为<strong>数组的集合，集合中每个对象代表一条记录，数组中每个元素代表一个字段 </strong> 。</p>
<p><strong>可以在持久化类中定义一个对象的构造器来包装投影查询返回的记录，使程序代码能完全运用面向对象的语义来访问查询结果集</strong>。还 可以通过DISTINCT关键字来保证查询结果不会返回重复元素。示例：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFieldQuery2</span>() {                                                                        </div><div class="line">    String hql = <span class="string">"SELECT new Employee(e.email, e.salary, e.dept) FROM Employee e where e.dept = :dept"</span>;</div><div class="line">    Department dept = <span class="keyword">new</span> Department();                                                                </div><div class="line">    dept.setId(<span class="number">1005</span>);                                                                                  </div><div class="line">    List&lt;Employee&gt; employees = session.createQuery(hql)                                                </div><div class="line">                                 .setEntity(<span class="string">"dept"</span>, dept)                                              </div><div class="line">                                 .list();                                                              </div><div class="line">    <span class="keyword">for</span>(Employee emp : employees) {                                                                    </div><div class="line">        System.<span class="keyword">out</span>.println(emp.getEmail() + <span class="string">"-"</span> + emp.getSalary() + <span class="string">"-"</span> + emp.getDept());              </div><div class="line">    }                                                                                                  </div><div class="line">}</div></pre></td></tr></table></figure>

<p>这时候Employee必须提供<code>public Employee(String email, float salary, Department dept)</code>构造器。</p>
<h4 id="报表查询">报表查询</h4>
<p>报表查询用于对数据分组和统计，与标准SQL一样，HQL利用GROUP BY关键字对数据分组，用HAVING关键字对分组数据设定约束条件。 在 HQL 查询语句中可以调用以下聚集函数：</p>
<ul>
<li>count()</li>
<li>min()</li>
<li>max()</li>
<li>sum()</li>
<li>avg()</li>
</ul>
<p>示例：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGroupBy</span>() {                                                 </div><div class="line">    String hql = <span class="string">"FROM Employee group by dept having min(salary) &gt; :salary"</span>;</div><div class="line">    List&lt;Employee&gt; employees = session.createQuery(hql)                     </div><div class="line">                                      .setInteger(<span class="string">"salary"</span>, <span class="number">6430</span>)           </div><div class="line">                                      .list();                              </div><div class="line">    System.<span class="keyword">out</span>.println(employees);                                          </div><div class="line">}</div></pre></td></tr></table></figure>

<h4 id="左外连接和迫切左外连接">左外连接和迫切左外连接</h4>
<p>左外连接需要注意的几点：</p>
<ul>
<li>使用<strong>LEFT JOIN</strong>关键字表示左外连接查询；</li>
<li><code>list()</code>方法返回的结果类型为<strong>集合数组类型</strong>，<strong>这是 因为在进行左外连接时，并不是查询单一的表，返回多个表的字段，所以并不不会自动封装为某个对象的集合！</strong>；</li>
<li>可以使用SELECT子句声明查询某个对象，这样<code>list()</code>方法就会返回该对象的集合；</li>
<li>因为没有<strong>FETCH</strong>关键字，所以左外连接 根据配置文件来决定返回集合的检索策略。</li>
</ul>
<p>示例：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> void testLeftJoin2() {                                    </div><div class="line">    String hql = <span class="string">"FROM Employee e LEFT JOIN e.dept"</span>;             </div><div class="line">    <span class="comment">// 返回值为List&lt;Object[]&gt;                                        </span></div><div class="line">    <span class="keyword">List</span>&lt;Object[]&gt; <span class="keyword">list</span> = session.createQuery(hql).<span class="keyword">list</span>();       </div><div class="line">    <span class="keyword">for</span>(Object[] obj : <span class="keyword">list</span>) {                                   </div><div class="line">        System.out.println(Arrays.asList(obj));                  </div><div class="line">    }                                                            </div><div class="line">    <span class="comment">// 返回值为List&lt;Employee&gt;                                        </span></div><div class="line">    String hql2 = <span class="string">"SELECT e FROM Employee e LEFT JOIN e.dept"</span>;   </div><div class="line">    <span class="keyword">List</span>&lt;Employee&gt; employees = session.createQuery(hql2).<span class="keyword">list</span>(); </div><div class="line">    System.out.println(employees);                               </div><div class="line">}</div></pre></td></tr></table></figure>

<p><strong>注意，不使用SELECT语句时返回值类型为<code>List&lt;Object[]&gt;</code>，加上SELECT后返回值才是<code>List&lt;Employee&gt;</code>！</strong></p>
<p>使用迫切左外连接要注意的几点：</p>
<ul>
<li>迫切左外连接使用<strong>LEFT JOIN FETCH</strong>关键字；</li>
<li>因为是<strong>迫切（FETCH）</strong>，所以<code>list()</code>方法返回的集合中存放的是 实体对象的引用，而不是数组的集合，<strong>而且实体对象都是已经实例化</strong>；</li>
<li>查询结果中可能会包含重复元素，可以通过一个<code>HashSet</code>或者DISTINCE关键字来过滤重复元素。</li>
</ul>
<p>示例：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testLeftOuterJoin</span>() {                                    </div><div class="line">    String hql = <span class="string">"FROM Employee e LEFT JOIN FETCH e.dept"</span>; </div><div class="line">    <span class="comment">// 返回值为List&lt;Employee&gt;           </span></div><div class="line">    List&lt;Employee&gt; employees = session.createQuery(hql).list();      </div><div class="line">     <span class="comment">// 使用HashSet或者DISTINCE去重</span></div><div class="line">    <span class="comment">// employees = new ArrayList&lt;&gt;(new HashSet&lt;&gt;(employees));</span></div><div class="line">    <span class="keyword">for</span>(Employee emp : employees) {                                  </div><div class="line">        System.<span class="keyword">out</span>.println(emp + <span class="string">" "</span> + emp.getDept());               </div><div class="line">    }                                                                </div><div class="line">}</div></pre></td></tr></table></figure>


<p>这里返回结果为<code>List&lt;Employee&gt;</code>，而不是<code>List&lt;Object[]&gt;</code>。而且由于<strong>FETCH</strong>关键字的作用，每个Employee对象中的Department已经实例化。</p>
<h4 id="内连接和迫切内连接">内连接和迫切内连接</h4>
<p>内连接关键字为<strong>INNER JOIN</strong>，迫切内连接关键字为<strong>INNER JOIN FETCH</strong>，用法和前面介绍的左外连接和迫切左外连接类似。</p>
<h3 id="QBC">QBC</h3>
<p>QBC也就是Query By Criteria，核心的API是<code>Criteria</code>接口，通过<code>Session</code>的<code>createCriteria</code>方法获取。<strong>QBC方式直接通过类的class或者类名得到SQL语句。</strong></p>
<p>相关API介绍：</p>
<ul>
<li><code>Criteria</code>：QBC查询接口，调用<code>list()</code>方法获取集合对象，调用<code>uniqueResult()</code>方法获取唯一结果，调用<code>add</code>方法添加查询条件；</li>
<li><code>Criterion</code>：代表查询条件，它有许多实现类。例如表示AND逻辑运算的<code>Conjunction</code>，表示OR关系的<code>Disjunction</code>；</li>
<li><code>Restrictions</code>：这个类提供了许多静态方法返回<code>Criterion</code>对象，例如<code>eq</code>、<code>like</code>等方法；</li>
</ul>
<p>下面是使用QBC实现的一些查询测试方法：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// QBC查询示例                                                                                          </span></div><div class="line">@Test                                                                                               </div><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testQuery</span>() {                                                                           </div><div class="line">    Criteria criteria = session.createCriteria(Employee.class);                                     </div><div class="line">    Department dept = <span class="keyword">new</span> Department();                                                             </div><div class="line">    dept.setId(<span class="number">1005</span>);                                                                               </div><div class="line">    criteria.add(Restrictions.eq(<span class="string">"dept"</span>, dept));                                                    </div><div class="line">    criteria.add(Restrictions.gt(<span class="string">"salary"</span>, <span class="number">6430</span>F));                                                 </div><div class="line">    List&lt;Employee&gt; employees = criteria.list();                                                     </div><div class="line">    System.<span class="keyword">out</span>.println(employees);                                                                  </div><div class="line">}                                                                                                   </div><div class="line"> </div><div class="line"><span class="comment">// 测试AND逻辑运算                                                                                        </span></div><div class="line">@Test                                                                                               </div><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testConjuction</span>() {                                                                      </div><div class="line">    <span class="comment">// (A and B and C...)                                                                           </span></div><div class="line">    Conjunction conjunction = Restrictions.conjunction();                                           </div><div class="line">    conjunction.add(Restrictions.like(<span class="string">"name"</span>, <span class="string">"h"</span>, MatchMode.ANYWHERE));                            </div><div class="line">    Department dept = <span class="keyword">new</span> Department();                                                             </div><div class="line">    dept.setId(<span class="number">1005</span>);                                                                               </div><div class="line">    conjunction.add(Restrictions.gt(<span class="string">"dept"</span>, dept));                                                 </div><div class="line">    System.<span class="keyword">out</span>.println(conjunction);                                                                </div><div class="line"> </div><div class="line">    Criteria criteria = session.createCriteria(Employee.class);                                     </div><div class="line">    criteria.add(conjunction);                                                                      </div><div class="line"> </div><div class="line">    List&lt;Employee&gt; employees = criteria.list();                                                     </div><div class="line">    System.<span class="keyword">out</span>.println(employees);                                                                  </div><div class="line">}                                                                                                   </div><div class="line"> </div><div class="line"><span class="comment">// OR逻辑运算                                                                                           </span></div><div class="line">@Test                                                                                               </div><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDisjunction</span>() {                                                                     </div><div class="line">    <span class="comment">// (A or B or C...)                                                                             </span></div><div class="line">    Disjunction disjunction = Restrictions.disjunction();                                           </div><div class="line">    disjunction.add(Restrictions.between(<span class="string">"salary"</span>, <span class="number">6440</span>F, <span class="number">6450</span>F));                                  </div><div class="line">    Department dept = <span class="keyword">new</span> Department();                                                             </div><div class="line">    dept.setId(<span class="number">1006</span>);                                                                               </div><div class="line">    disjunction.add(Restrictions.eq(<span class="string">"dept"</span>, dept));                                                 </div><div class="line">    System.<span class="keyword">out</span>.println(disjunction);                                                                </div><div class="line"> </div><div class="line">    Criteria criteria = session.createCriteria(Employee.class);                                     </div><div class="line">    criteria.add(disjunction);                                                                      </div><div class="line"> </div><div class="line">    List&lt;Employee&gt; employees = criteria.list();                                                     </div><div class="line">    System.<span class="keyword">out</span>.println(employees);                                                                  </div><div class="line">}                                                                                                   </div><div class="line"> </div><div class="line"><span class="comment">// 报表查询                                                                                             </span></div><div class="line">@Test                                                                                               </div><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testProjection</span>() {                                                                      </div><div class="line">    Criteria criteria = session.createCriteria(Employee.class);                                     </div><div class="line">    Float maxSalary = (Float) criteria.setProjection(Projections.max(<span class="string">"salary"</span>)).uniqueResult();     </div><div class="line">    System.<span class="keyword">out</span>.println(maxSalary);                                                                  </div><div class="line">}                                                                                                   </div><div class="line"> </div><div class="line"><span class="comment">// 分页查询                                                                                             </span></div><div class="line">@Test                                                                                               </div><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPage</span>() {                                                       </div><div class="line">    Criteria criteria = session.createCriteria(Employee.class);                </div><div class="line">    <span class="keyword">int</span> pageNo = <span class="number">2</span>;                                                            </div><div class="line">    <span class="keyword">int</span> pageSize = <span class="number">4</span>;                                                          </div><div class="line">    List&lt;Employee&gt; employees = criteria.setFirstResult((pageNo - <span class="number">1</span>) * pageSize)</div><div class="line">                                       .setMaxResults(pageSize)                </div><div class="line">                                       .addOrder(Order.desc(<span class="string">"salary"</span>))         </div><div class="line">                                       .addOrder(Order.asc(<span class="string">"name"</span>))            </div><div class="line">                                       .list();                                </div><div class="line">    System.<span class="keyword">out</span>.println(employees);                                             </div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="原生SQL">原生SQL</h3>
<p>执行原生SQL语句，使用的接口是<code>SQLQuery</code>，可以通过<code>Session</code>的<code>createSQLQuery</code>方法获取。<code>SQLQuery</code>接口同样提供了许多设置参数的方法。<br><strong>注意，<code>SQLQuery</code>还支持命名参数的绑定形式，也就是在原生的SQL语句中除了使用<code>?</code>绑定参数，还可以使用<code>:</code>加参数名的方式绑定。</strong></p>
<p>示例：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSQLQuery</span>() {                                                          </div><div class="line">    <span class="comment">// 元素的SQL，支持命名参数绑定                                                                </span></div><div class="line">    String sql = <span class="string">"select e.* from employees e, departments d "</span>                        </div><div class="line">            + <span class="string">"where e.dept_id = d.id and e.salary between :minSalary and :maxSalary"</span>;</div><div class="line">    SQLQuery query = session.createSQLQuery(sql);                                     </div><div class="line">    List&lt;Object[]&gt; list = query.setInteger(<span class="string">"minSalary"</span>, <span class="number">6430</span>)                         </div><div class="line">                                    .setInteger(<span class="string">"maxSalary"</span>, <span class="number">6440</span>)                    </div><div class="line">                                    .list();                                          </div><div class="line">    <span class="keyword">for</span>(Object[] obj : list) {                                                        </div><div class="line">        System.<span class="keyword">out</span>.println(Arrays.toString(obj));                                     </div><div class="line">    }                                                                                 </div><div class="line">}</div></pre></td></tr></table></figure>

<blockquote>
<p>下面是补充内容<br>参考资料：<br><a href="http://newleague.iteye.com/blog/1001652" target="_blank" rel="external">hibernate中SQLQuery的addEntity();方法</a><br>[使用Hibernate SQLQuery执行原生SQL](<a href="http://itindex.net/detail/51776-hibernate-sqlquery-sql0" target="_blank" rel="external">http://itindex.net/detail/51776-hibernate-sqlquery-sql0</a></p>
</blockquote>
<h4 id="使用自定义的结果转换器处理查询结果：_setResultTransformer">使用自定义的结果转换器处理查询结果： setResultTransformer</h4>
<p>SQLQuery 接口预留了<code>setResultTransformer</code>接口以实现使用用户自定义的<code>ResultTransformer</code>结果集转换器处理查询结果。 <code>ResultTransformer</code>接口非常简单，只有两个方法，分别用来转换单行数据和所有结果数据。<strong>经过自定义<code>ResultTransformer</code>生成的实体，并未加入Session，因此是非受管实体。</strong></p>
<p>如下代码，示范了如何将单行数据装入<code>LinkedHashMap</code>对象中：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">query.setResultTransformer(newResultTransformer() {                        </div><div class="line">    @Override</div><div class="line">    <span class="keyword">public</span> <span class="built_in">Object</span> transformTuple(<span class="built_in">Object</span>[] values, <span class="built_in">String</span>[] columns) { </div><div class="line">        Map&lt;<span class="built_in">String</span>, <span class="built_in">Object</span>&gt; map = <span class="keyword">new</span> LinkedHashMap &lt; <span class="built_in">String</span>, <span class="built_in">Object</span>&gt;(<span class="number">1</span>);   </div><div class="line">        int i = <span class="number">0</span>;                                                         </div><div class="line">        <span class="keyword">for</span> (<span class="built_in">String</span> column : columns) {                                    </div><div class="line">            map.put(column,  values[i++]);                                  </div><div class="line">        }                                                                  </div><div class="line">        <span class="keyword">return</span> map;                                                        </div><div class="line">    } </div><div class="line"></div><div class="line"></div><div class="line">    @Override</div><div class="line">    <span class="keyword">public</span> List transformList(List list) {                       </div><div class="line">        <span class="keyword">return</span> list;                                                       </div><div class="line">    }                                                                      </div><div class="line">});</div></pre></td></tr></table></figure>

<p>如果不设置自定义的<code>ResultTransformer</code>转换器，则Hibernate将每行返回结果的数据按照结果列的顺序装入Object数组中。</p>
<p>因此Hibernate提供了一个工具类： <code>Transformers</code>，它有一些常用的转换器，能够帮助我们快速转换结果集，如<code>Transformers.aliasToBean(Note.class)</code>能够将查询结果依别名注入到Note实体中。</p>
<h4 id="使用标量">使用标量</h4>
<p>使用<code>SQLQuery</code>执行原生SQL时，Hibernate会使用<code>ResultSetMetadata</code>来判定返回的标量值的实际顺序和类型。如果要避免过多的使用<code>ResultSetMetadata</code>，或者只是为了更加明确的指名返回值，可以使用<code>addScalar()</code>方法，例如：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">session.createSQLQuery("<span class="operator"><span class="keyword">select</span> * <span class="keyword">from</span> note <span class="keyword">where</span> id = <span class="number">1</span><span class="string">")</span></span></div><div class="line">       .addScalar("id<span class="string">", LongType.INSTANCE)              </span></div><div class="line">       .addScalar("name<span class="string">", StringType.INSTANCE)          </span></div><div class="line">       .addScalar("createtime<span class="string">", DateType.INSTANCE);</span></div></pre></td></tr></table></figure>

<p>这个查询指定了SQL查询字符串 ， 要返回的字段和类型.它仍然会返回Object数组 ， 但是此时不再使用ResultSetMetdata ， 而是明确的将id ， name和 createtime按照<code>Long</code> ，  <code>String</code>和<code>Date</code>类型从resultset中取出。<strong>同时，也指明了就算query是使用<code>*</code>来查询的，可能获得超过列出的这三个字段，也仅仅会返回这 三个字段。</strong></p>
<p>关于从<code>ResultSetMetaData</code>返回的<code>java.sql.Types</code>是如何映射到Hibernate类型，实际是由方言（Dialect）控制的。假若某个指定的类型没有被映射，或者不是你所预期的类型，可以通过<code>Dialet</code>的<code>registerHibernateType</code>调用自行定义。</p>
<p>如果仅指定了一个scalar，那么：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">Date</span> createTime =(<span class="built_in">Date</span>)session.createSQLQuery(<span class="string">"select * from note where id = 1"</span>) </div><div class="line">        .addScalar(<span class="string">"createtime"</span>,DateType.INSTANCE)                               </div><div class="line">        .uniqueResult();</div></pre></td></tr></table></figure>

<p>如果SQL语句使用了聚合函数，如count、max、min、avg等，且返回结果仅一个字段，那么Hibernate提供的这种提取标量结果的方式就非常便捷了。</p>
<h4 id="实体查询：addEntity">实体查询：addEntity</h4>
<p>上面的查询都是返回标量值的，也就是从resultset中返回的“裸”数据。下面展示如何通过<code>addEntity()</code>让原生查询返回实体对象。<br>示例：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">session.createSQLQuery("<span class="operator"><span class="keyword">select</span> * <span class="keyword">from</span> note <span class="keyword">where</span> id = <span class="number">1</span><span class="string">").addEntity(Note.class); </span></span></div><div class="line">session.createSQLQuery("<span class="keyword">select</span> id, name, createtime <span class="keyword">from</span> note <span class="keyword">where</span> id = <span class="number">1</span><span class="string">").addEntity(Note.class);</span></div></pre></td></tr></table></figure>

<p>这个查询指定SQL查询字符串 ， 要返回的实体。假设Note被映射为拥有id ， name和createtime三个字段的类，以上的两个查询都返回一个List，每个元素都是一个Note实体。</p>
<p><strong>假若实体在映射时有一个many-to-one的关联指向另外一个实体，在查询时必须也返回那个实体，否则会导致发生一个”column not found”的数据库错误。</strong>这些附加的字段可以使用<code>*</code>标注来自动返回，但我们希望还是明确指明，看下面这个具有指向Dog的many-to-one的例子：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">session.createSQLQuery("<span class="operator"><span class="keyword">select</span> id, note, createtime, author <span class="keyword">from</span> note <span class="keyword">where</span> id = ?<span class="string">").addEntity(Note.class);</span></span></div></pre></td></tr></table></figure>

<p>author字段即为Note实体和Author实体的关联字段，只需在查询时得到该字段的值，Hibernate即可使用该值找到对应的关联实体。<br>如上例中，note.getAuthor()即可返回当前Note所属的Author对象。</p>
  
	</div>
		<footer class="article-footer clearfix">




<div class="article-share" id="share">

  <div data-url="http://yoursite.com/2015/04/27/Java/Hibernate/Hibernate4完全教程（四）：继承映射、检索策略和检索方式/" data-title="LC的笔记" data-tsina="null" class="share clearfix">
  </div>

</div>
</footer>   	       
	</article>
	
<nav class="article-nav clearfix">
 

<div class="next">
<a href="/2015/04/27/Java/Hibernate/Hibernate4完全教程（一）：入门使用/"  title="">
 <strong>NEXT:</strong><br/> 
 <span>(no title)
</span>
</a>
</div>

</nav>

	
</div>  
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">Contents</strong>
  <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#tags:[hibernate]"><span class="toc-number">1.</span> <span class="toc-text">tags:[hibernate]</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#继承映射"><span class="toc-number">2.</span> <span class="toc-text">继承映射</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#使用subclass"><span class="toc-number">2.1.</span> <span class="toc-text">使用subclass</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用joined-subclass"><span class="toc-number">2.2.</span> <span class="toc-text">使用joined-subclass</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用union-subclass"><span class="toc-number">2.3.</span> <span class="toc-text">使用union-subclass</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#检索策略"><span class="toc-number">3.</span> <span class="toc-text">检索策略</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#class元素的lazy属性作用"><span class="toc-number">3.1.</span> <span class="toc-text">class元素的lazy属性作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#set元素的lazy属性作用"><span class="toc-number">3.2.</span> <span class="toc-text">set元素的lazy属性作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#set元素的batch-size属性"><span class="toc-number">3.3.</span> <span class="toc-text">set元素的batch-size属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#set元素的fetch属性"><span class="toc-number">3.4.</span> <span class="toc-text">set元素的fetch属性</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Hibernate检索方式"><span class="toc-number">4.</span> <span class="toc-text">Hibernate检索方式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#HQL"><span class="toc-number">4.1.</span> <span class="toc-text">HQL</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#绑定参数"><span class="toc-number">4.1.1.</span> <span class="toc-text">绑定参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HQL分页查询"><span class="toc-number">4.1.2.</span> <span class="toc-text">HQL分页查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HQL命名SQL语句"><span class="toc-number">4.1.3.</span> <span class="toc-text">HQL命名SQL语句</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#投影查询"><span class="toc-number">4.1.4.</span> <span class="toc-text">投影查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#报表查询"><span class="toc-number">4.1.5.</span> <span class="toc-text">报表查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#左外连接和迫切左外连接"><span class="toc-number">4.1.6.</span> <span class="toc-text">左外连接和迫切左外连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#内连接和迫切内连接"><span class="toc-number">4.1.7.</span> <span class="toc-text">内连接和迫切内连接</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#QBC"><span class="toc-number">4.2.</span> <span class="toc-text">QBC</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#原生SQL"><span class="toc-number">4.3.</span> <span class="toc-text">原生SQL</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#使用自定义的结果转换器处理查询结果：_setResultTransformer"><span class="toc-number">4.3.1.</span> <span class="toc-text">使用自定义的结果转换器处理查询结果： setResultTransformer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#使用标量"><span class="toc-number">4.3.2.</span> <span class="toc-text">使用标量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#实体查询：addEntity"><span class="toc-number">4.3.3.</span> <span class="toc-text">实体查询：addEntity</span></a></li></ol></li></ol></li></ol>
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">

  

  
<div class="tagslist">
	<p class="asidetitle">Tags</p>
		<ul class="clearfix">
		
			<li><a href="/tags/JDBC/" title="JDBC">JDBC<sup>3</sup></a></li>
		
			<li><a href="/tags/Java/" title="Java">Java<sup>3</sup></a></li>
		
			<li><a href="/tags/Oracle/" title="Oracle">Oracle<sup>6</sup></a></li>
		
			<li><a href="/tags/SQL/" title="SQL">SQL<sup>6</sup></a></li>
		
		</ul>
</div>


  <div class="rsspart">
	<a href="null" target="_blank" title="rss">RSS</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<div class="social-font clearfix">
		
		
		
		
		
	</div>
		<p class="copyright">Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/A-limon/pacman" target="_blank" title="Pacman">Pacman</a> © 2015 
		
		<a href="http://yoursite.com" target="_blank" title="zlc">zlc</a>
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    o.click(function(){
      ta.css('display', 'none');
    });
    $(window).scroll(function(){
      ta.css("top",Math.max(140,320-$(this).scrollTop()));
    });
  };
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});     
</script>






  </body>
</html>
