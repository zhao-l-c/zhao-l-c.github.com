
 <!DOCTYPE HTML>
<html lang="zh-cn">
<head>
  <meta charset="UTF-8">
  
    <title>JDBC详解（一） | LC的学习笔记</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
    
    <meta name="author" content="zlc">
    
    <meta name="description" content="JDBC API
下面介绍了常用的JDBC API：

Driver
Connection
DriverManager
Statement
PreparedStatement
ResultSet
ResultSetMetaData

还介绍了使用反射的方法，根据属性名和属性值封装实体对象（也就是根据SQL语句的查询结果封装为实例对象）！">
    
    
    
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/pacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/pacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">

</head>

  <body>
    <header>
      <div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.svg" alt="LC的学习笔记" title="LC的学习笔记"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="LC的学习笔记">LC的学习笔记</a></h1>
				<h2 class="blog-motto">平时学习的内容整理为简单的教程，避免过目即忘</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
					<li>
					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="text" id="search" name="q" autocomplete="off" maxlength="20" placeholder="Search" />
						<input type="hidden" name="q" value="site:yoursite.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>

    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/02/14/Java/JDBC/JDBC详解（一）/" title="JDBC详解（一）" itemprop="url">JDBC详解（一）</a>
  </h1>
  <p class="article-author">By
    
      <a href="http://yoursite.com" title="zlc">zlc</a>
    </p>
  <p class="article-time">
    <time datetime="2015-02-14T15:03:16.000Z" itemprop="datePublished">2月 14 2015</time>
    Updated:<time datetime="2015-02-14T15:29:30.000Z" itemprop="dateModified">2月 14 2015</time>
    
  </p>
</header>
	<div class="article-content">
		
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">Contents</strong>
		<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#JDBC_API"><span class="toc-number">1.</span> <span class="toc-text">JDBC API</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Driver和Connection接口"><span class="toc-number">1.1.</span> <span class="toc-text">Driver和Connection接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DriverManager类"><span class="toc-number">1.2.</span> <span class="toc-text">DriverManager类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Statement接口"><span class="toc-number">1.3.</span> <span class="toc-text">Statement接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ResultSet接口"><span class="toc-number">1.4.</span> <span class="toc-text">ResultSet接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PreparedStatement"><span class="toc-number">1.5.</span> <span class="toc-text">PreparedStatement</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ResultSetMetaData"><span class="toc-number">1.6.</span> <span class="toc-text">ResultSetMetaData</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CallableStatement"><span class="toc-number">1.7.</span> <span class="toc-text">CallableStatement</span></a></li></ol></li></ol>
		</div>
		
		<h2 id="JDBC_API">JDBC API</h2>
<p>下面介绍了常用的JDBC API：</p>
<ul>
<li>Driver</li>
<li>Connection</li>
<li>DriverManager</li>
<li>Statement</li>
<li>PreparedStatement</li>
<li>ResultSet</li>
<li>ResultSetMetaData</li>
</ul>
<p>还介绍了使用反射的方法，根据属性名和属性值封装实体对象（也就是根据SQL语句的查询结果封装为实例对象）！</p>
<a id="more"></a>
<h3 id="Driver和Connection接口">Driver和Connection接口</h3>
<p>Driver是数据库驱动接口，JDK文档中没有这个接口的实现类，它的实现类是数据库厂商提供，例如对于MySQL数据库的Driver对象创建方法如下：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Driver driver = <span class="keyword">new</span> <span class="keyword">com</span>.mysql.jdbc.Driver();</div></pre></td></tr></table></figure>

<p>它的<code>connect(String url, Properties info)</code>方法用于获取链接，即<code>Connection</code>对象。</p>
<p>实际代码可以这样做：</p>
<ul>
<li>最基本的方法：直接把数据库链接的配置都写在代码里，例如要获取MySQL数据库的<code>Connection</code>对象：</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 获取数据库的Driver实例对象                              </span></div><div class="line"><span class="constant">Driver mysqlDriver</span> = new com.mysql.jdbc.Driver();</div><div class="line"><span class="comment">// 数据库连接信息</span></div><div class="line"><span class="constant">String url</span> = <span class="string">"jdbc:mysql://127.0.0.1:3306/mysql"</span>;</div><div class="line"><span class="constant">Properties info</span> = new Properties();              </div><div class="line">info.put(<span class="string">"user"</span>, <span class="string">"root"</span>);                        </div><div class="line">info.put(<span class="string">"password"</span>, <span class="string">"mysql"</span>);                   </div><div class="line"><span class="comment">// 获取Connection实例对象                              </span></div><div class="line"><span class="constant">Connection con</span> = mysqlDriver.connect(url, info); </div><div class="line"><span class="constant">System.out.println(con);</span></div></pre></td></tr></table></figure>


<p>这种方法直接把数据库连接的配置都写在代码里。</p>
<ul>
<li>第二种方法是从配置文件中读取配置信息，并且用反射的方法获取<code>Driver</code>实例对象：</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">// 加载配置文件</div><div class="line">InputStream <span class="keyword">is</span> = ConnectionTest.class.getClassLoader().getResourceAsStream(<span class="string">"jdbc.properties"</span>);</div><div class="line">Properties <span class="keyword">pro</span> = <span class="keyword">new</span> Properties();                                                            </div><div class="line"><span class="keyword">pro</span>.load(<span class="keyword">is</span>);                                                                                 </div><div class="line">// 获取驱动全类名</div><div class="line">String driverName = <span class="keyword">pro</span>.getProperty(<span class="string">"driver"</span>);                                                </div><div class="line">// 用反射获取Driver实例对象                                                                            </div><div class="line">Driver driver = (Driver)Class.forName(driverName).newInstance();                              </div><div class="line">// 得到Connection对象</div><div class="line">Connection <span class="keyword">con</span> = driver.connect(<span class="keyword">pro</span>.getProperty(<span class="string">"url"</span>), <span class="keyword">pro</span>);                                 </div><div class="line">System.out.println(<span class="keyword">con</span>);</div></pre></td></tr></table></figure>


<p>代码<code>Driver driver = (Driver)Class.forName(driverName).newInstance();</code>根据MySQL数据库的驱动全类名反射获取<code>Driver</code>对象。</p>
<ul>
<li>最后更为理想的方法是把<code>Driver</code>对象交给<code>DriverManager</code>对象进行管理：</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 加载配置文件</span></div><div class="line">InputStream <span class="keyword">is</span> = ConnectionTest.<span class="keyword">class</span>.getClassLoader().getResourceAsStream(<span class="string">"jdbc.properties"</span>); </div><div class="line">Properties pro = <span class="keyword">new</span> Properties();                                                             </div><div class="line">pro.load(<span class="keyword">is</span>);   </div><div class="line"><span class="comment">// 获取驱动全类名                                                                               </span></div><div class="line">String driverName = pro.getProperty(<span class="string">"driver"</span>);                                                 </div><div class="line"><span class="comment">// 往DriverManager中注册驱动                                                                         </span></div><div class="line">Class.forName(driverName);                                                                     </div><div class="line"><span class="comment">// 上面代码的作用和下面是等价的：                                                                             </span></div><div class="line"><span class="comment">/*</span></div><div class="line">Driver driver;                                                                                 </div><div class="line">try {                                                                                          </div><div class="line">    driver = (Driver)Class.forName(driverName).newInstance();                                  </div><div class="line">    DriverManager.registerDriver(driver);                                                      </div><div class="line">} catch (InstantiationException | IllegalAccessException e) {                                  </div><div class="line">    e.printStackTrace();                                                                       </div><div class="line">}                                                                                              </div><div class="line">*/</div><div class="line">Connection con = DriverManager.getConnection(pro.getProperty(<span class="string">"url"</span>), pro);                     </div><div class="line">System.<span class="keyword">out</span>.println(con);</div></pre></td></tr></table></figure>


<p>那怎么让<code>DriverManager</code>管理<code>Connection</code>对象呢？其实就是调用它的<code>registerDriver</code>方法。这个方法在执行反射代码<code>Class.forName(driverName)</code>的时候已经执行注册（**具体代码在MySQL的Driver实现类中的静态代码块里面），所以用户无需自己编写，最后就直接可以从<code>DriverManager</code>中获取<code>Connection</code>对象了。</p>
<h3 id="DriverManager类">DriverManager类</h3>
<p><code>DriverManager</code>类是驱动程序管理器类，负责管理驱动程序。<br>通常JDBC代码中不用显式调用<code>DriverManager.registerDriver(driver )</code>方法来注册驱动程序类的实例，因为<code>Driver</code> 接口的不同数据库具体实现类都包含了静态代码块，在这个静态代码块中，会调用 <code>DriverManager.registerDriver(driver)</code>方法来注册自身的一个实例，所以使用时直接调用<code>Class.forName( driverName)</code>即可。</p>
<h3 id="Statement接口">Statement接口</h3>
<p>调用<code>Connection</code> 对象的<code>createStatement()</code>方法可以创建<code>Statement</code>对象，该对象用于执行静态的 SQL 语句，并且返回执行结果。</p>
<p><code>Statement</code>接口中定义了下列方法用于执行 SQL 语句：</p>
<ul>
<li><code>excuteUpdate(String sql)</code>：执行增、删、改功能，返回<code>int</code> 类型值。示例：</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpdate</span>() {                                                                                     </div><div class="line">    String sql = <span class="string">"insert into customer(id, name, email, birth) values (4, 'ddd', 'abc@sina.com.cn', '1990-8-15')"</span>;</div><div class="line">    Statement stmt = <span class="keyword">null</span>;                                                                                     </div><div class="line">    Connection conn = JDBCUtil.getConnection();                                                                </div><div class="line">    <span class="keyword">try</span> {                                                                                                      </div><div class="line">        stmt = conn.createStatement();                                                                         </div><div class="line">        <span class="comment">// executeUpdate包括insert、delete和update操作还有创建数据库等的DDL操作                                                 </span></div><div class="line">        <span class="keyword">int</span> rowCount = stmt.executeUpdate(sql);                                                                </div><div class="line">        System.<span class="keyword">out</span>.println(<span class="string">"更新了"</span> + rowCount + <span class="string">"条记录。"</span>);                                                         </div><div class="line">    } <span class="keyword">catch</span> (SQLException e) {                                                                                 </div><div class="line">        e.printStackTrace();                                                                                   </div><div class="line">    } <span class="keyword">finally</span> {                                                                                                </div><div class="line">        JDBCUtil.release(conn, stmt, <span class="keyword">null</span>);                                                                    </div><div class="line">    }                                                                                                          </div><div class="line">}</div></pre></td></tr></table></figure>



<ul>
<li><code>excuteQuery(String sql)</code>：执行查询功能，返回结果为<code>ResultSet</code>类型值。示例：</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testQuery</span>() {                                                     </div><div class="line">    String sql = <span class="string">"select id, name, email, birth from customer"</span>;               </div><div class="line"> </div><div class="line">    Statement stmt = <span class="keyword">null</span>;                                                    </div><div class="line">    ResultSet rs = <span class="keyword">null</span>;                                                      </div><div class="line">    Connection conn = JDBCUtil.getConnection();                               </div><div class="line">    <span class="keyword">try</span> {                                                                     </div><div class="line">        stmt = conn.createStatement();                                        </div><div class="line">        <span class="comment">// executeQuery执行查询操作                                                 </span></div><div class="line">        rs = stmt.executeQuery(sql);                                          </div><div class="line">        <span class="keyword">while</span>(rs.next()) {                                                    </div><div class="line">            <span class="keyword">int</span> id = rs.getInt(<span class="string">"id"</span>);                                         </div><div class="line">            String name = rs.getString(<span class="string">"name"</span>);                               </div><div class="line">            String email = rs.getString(<span class="string">"email"</span>);                             </div><div class="line">            Date date = rs.getDate(<span class="string">"birth"</span>);                                  </div><div class="line">            System.<span class="keyword">out</span>.println(id + <span class="string">"\t"</span> + name + <span class="string">"\t"</span> + email + <span class="string">"\t"</span> + date);</div><div class="line">        }                                                                     </div><div class="line">    } <span class="keyword">catch</span> (SQLException e) {                                                </div><div class="line">        e.printStackTrace();                                                  </div><div class="line">    } <span class="keyword">finally</span> {                                                               </div><div class="line">        JDBCUtil.release(conn, stmt, <span class="keyword">null</span>);                                   </div><div class="line">    }                                                                         </div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="ResultSet接口">ResultSet接口</h3>
<p>调用<code>Statement</code>对象的 <code>excuteQuery()</code> 方法创建该对象（参考上面示例）。</p>
<p><code>ResultSet</code> 对象以逻辑表格的形式封装了执行数据库操作的结果集，<strong>这个接口由数据库厂商实现</strong>。<br><strong><code>ResultSet</code>对象维护了一个指向当前数据行的游标，初始的时候游标在第一行之前，可以通过 <code>next()</code>方法判断是否有下一行并移动到下一行。相当于<code>Iterator</code>的<code>hasNext()</code>和<code>next()</code>方法的结合体！</strong></p>
<p>该接口的常用方法：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="title">next</span><span class="params">()</span>：返回 <span class="title">boolean</span> 值，判断是否还有下一行并移动到下一行</span></div><div class="line"><span class="title">getString</span><span class="params">()</span>：返回 S<span class="title">tring</span> 类型的值</div><div class="line"><span class="title">getInt</span><span class="params">()</span>：返回 I<span class="title">nt</span> 类型的值</div><div class="line"><span class="title">getDate</span><span class="params">()</span>：返回 D<span class="title">ate</span> 类型的值</div><div class="line">……</div></pre></td></tr></table></figure>

<blockquote>
<p>关闭资源</p>
</blockquote>
<p><strong>注意，<code>Connection</code>、<code>Statement</code>和<code>ResultSet</code>这些资源使用完后都一定要关闭，而且先获取的后关闭，因此关闭顺序是<code>ResultSet</code>-&gt;<code>Statement</code>-&gt;<code>Connection</code>。</strong></p>
<h3 id="PreparedStatement">PreparedStatement</h3>
<p>调用<code>Connection</code>对象的<code>preparedStatement()</code>方法获取 <code>PreparedStatement</code>对象，使用<code>PreparedStatement</code>会进行语法检查、语义检查、预编译，所以可以防止SQL注入的问题。</p>
<p><code>PreparedStatement</code>接口是 Statement 的子接口，<strong>它表示一条预编译过的 SQL 语句</strong>。<code>PreparedStatement</code> 对象所代表的 SQL 语句中的参数用问号<code>?</code>来表示，调用对象的<code>setXXX()</code> 方法来设置这些参数。<code>setXXX()</code>方法有两个参数，第一个参数表示要设置参数的索引（<strong>注意从 1 开始</strong>），第二个表示要设置参数的值。</p>
<p>最后<code>PreparedStatement</code>执行更新和查询操作是调用<code>executeUpdate()</code>和<code>executeQuery()</code>方法，和<code>Statement</code>的区别是不需要出入SQL语句作为参数。<br>示例：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateRow</span>(String sql, Object... args) {                 </div><div class="line">    Connection conn = JDBCUtil.getConnection();                     </div><div class="line">    PreparedStatement ps = <span class="keyword">null</span>;                                    </div><div class="line">    <span class="keyword">try</span> {                                                           </div><div class="line">        ps = conn.prepareStatement(sql);                            </div><div class="line">        <span class="comment">// 设置占位符对应的值                                                </span></div><div class="line">        <span class="keyword">if</span>(args != <span class="keyword">null</span>) {                                          </div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; args.length; i++) {                  </div><div class="line">                ps.setObject(i + <span class="number">1</span>, args[i]); <span class="comment">// setXXX的索引从1开始      </span></div><div class="line">            }                                                       </div><div class="line">        }                                                           </div><div class="line">        <span class="keyword">int</span> updateRow = ps.executeUpdate();                         </div><div class="line">        System.<span class="keyword">out</span>.println(<span class="string">"更新了"</span> + updateRow + <span class="string">"行记录。"</span>);             </div><div class="line">    } <span class="keyword">catch</span> (SQLException e) {                                      </div><div class="line">        e.printStackTrace();                                        </div><div class="line">    } <span class="keyword">finally</span> {                                                     </div><div class="line">        JDBCUtil.release(conn, ps, <span class="keyword">null</span>);                           </div><div class="line">    }                                                               </div><div class="line">}                         </div><div class="line"></div><div class="line">@Test                                                                                                </div><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpdateRow</span>() {                                                                        </div><div class="line">    String sql = <span class="string">"insert into customer(id, name, email, birth) values(?, ?, ?, ?)"</span>;                  </div><div class="line">    updateRow(sql, <span class="number">11</span>, <span class="string">"hehe"</span>, <span class="string">"hehe@baidu.com"</span>, <span class="keyword">new</span> java.sql.Date(<span class="keyword">new</span> java.util.Date().getTime())); </div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="ResultSetMetaData">ResultSetMetaData</h3>
<p>使用<code>ResultSet</code>类中的<code>getMetaData()</code> 方法获取对应列的<code>ResultSetMetaData</code>的对象，<strong>注意在遍历<code>ResultSet</code>对象时每次都要单独获取<code>ResultSetMetaData</code>对象，虽然每次的列的数目、列名都相等，但列的值不等。</strong></p>
<p><code>ResultSetMetaData</code>可用于获取关于 ResultSet 对象中列的数目、列名、列的类型等信息，有以下常用方法：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="title">getColumnCount</span><span class="params">()</span>：返回当前 R<span class="title">esultSet</span> 对象中的列数。</span></div><div class="line"><span class="title">getColumnLabel</span><span class="params">(int column)</span>：返回列的别名，参数从1 开始。</div><div class="line"><span class="title">getColumnName</span><span class="params">(int column)</span>：获取列的名称，参数从1 开始。</div><div class="line">……</div></pre></td></tr></table></figure>

<p><strong>注意区分列名和列的别名</strong>，例如<code>select id customerId from ......</code>中，<code>id</code>是列名，<code>customerId</code>是列的别名。</p>
<p><strong>因此使用<code>ResultSetMetaData</code>和<code>ResultSet</code>结合，就能获取列名（属性名）和对应的值（属性值）。有了属性名和属性值就能用反射封装具体的实体类。</strong></p>
<p>示例：查询一条记录，并返回结果对象。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> &lt;T&gt; T <span class="title">fetchRow</span>(String sql, Class&lt;T&gt; clazz, Object...args) {                           </div><div class="line">    Connection conn = JDBCUtil.getConnection();                                              </div><div class="line">    PreparedStatement ps = <span class="keyword">null</span>;                                                             </div><div class="line">    ResultSet rs = <span class="keyword">null</span>;                                                                     </div><div class="line">    <span class="keyword">try</span> {                                                                                    </div><div class="line">        ps = conn.prepareStatement(sql);                                                     </div><div class="line">        <span class="comment">// 设置SQL语句中的绑定参数                                                                     </span></div><div class="line">        <span class="keyword">if</span>(args != <span class="keyword">null</span>) {                                                                   </div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; args.length; i++) {                                           </div><div class="line">                ps.setObject(i + <span class="number">1</span>, args[i]);                                                </div><div class="line">            }                                                                                </div><div class="line">        }                                                                                    </div><div class="line">        rs = ps.executeQuery();                                                              </div><div class="line">        <span class="keyword">while</span>(rs.next()) {                                                                   </div><div class="line">            <span class="comment">// 利用反射创建实体类对象                                                                   </span></div><div class="line">            T instance = clazz.newInstance();                                                </div><div class="line">            <span class="comment">// Retrieves the number, types and properties of this ResultSet object's columns.</span></div><div class="line">            ResultSetMetaData rsmd = rs.getMetaData();                                       </div><div class="line">            <span class="comment">// 获取列数                                                                          </span></div><div class="line">            <span class="keyword">int</span> columnCount = rsmd.getColumnCount();                                         </div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; columnCount; i++) {                                           </div><div class="line">                String columnLablel = rsmd.getColumnLabel(i + <span class="number">1</span>);                            </div><div class="line">                Object <span class="keyword">value</span> = rs.getObject(columnLablel);                                   </div><div class="line">                <span class="comment">// 利用PropertyUtils设置工具类                                                      </span></div><div class="line">                <span class="comment">// PropertyUtils.setProperty(instance, columnLablel, value);                 </span></div><div class="line">                JDBCUtil.setProperty(instance, columnLablel, <span class="keyword">value</span>);                         </div><div class="line">            }                                                                                </div><div class="line">            <span class="keyword">return</span> instance;                                                                 </div><div class="line">        }                                                                                    </div><div class="line">    } <span class="keyword">catch</span> (Exception e) {                                                                  </div><div class="line">        e.printStackTrace();                                                                 </div><div class="line">    } <span class="keyword">finally</span> {                                                                              </div><div class="line">        JDBCUtil.release(conn, ps, rs);                                                      </div><div class="line">    }                                                                                        </div><div class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</div></pre></td></tr></table></figure>

<p>在这个示例中，首先根据<code>Class</code>对象构造返回结果的空对象，最后设置空对象的属性值，这时候可以用<strong>commons-beanutils-xxx.jar</strong>提供的<code>PropertyUtils.setProperty()</code>方法，或者自己编写类似的方法，例如这里的<code>JDBCUtil.setProperty()</code>：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="title">public</span> static void setProperty(<span class="type">Object</span> <span class="keyword">instance</span>, <span class="type">String</span> name, <span class="type">Object</span> value) {</div><div class="line">    try {                                                                  </div><div class="line">        <span class="type">PropertyDescriptor</span> pd = new <span class="type">PropertyDescriptor</span>(name,               </div><div class="line"><span class="class">                <span class="keyword">instance</span>.getClass<span class="container">()</span>);                                      </span></div><div class="line">        pd.getWriteMethod<span class="container">()</span>.invoke<span class="container">(<span class="title">instance</span>, <span class="title">value</span>)</span>;                       </div><div class="line">    } catch <span class="container">(<span class="type">IntrospectionException</span> | <span class="type">IllegalAccessException</span>               </span></div><div class="line">            | <span class="type">IllegalArgumentException</span> | <span class="type">InvocationTargetException</span> <span class="title">e</span>) {    </div><div class="line">        e.printStackTrace<span class="container">()</span>;                                               </div><div class="line">    }                                                                      </div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="CallableStatement">CallableStatement</h3>
<p>用于执行 SQL 存储过程的接口。JDBC API 提供了一个存储过程 SQL 转义语法，如下：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">{?= call &lt;procedure-name&gt;[(&lt;arg1&gt;,&lt;arg2&gt;, <span class="keyword">...</span>)]}</div><div class="line">{call &lt;procedure-name&gt;[(&lt;arg1&gt;,&lt;arg2&gt;, <span class="keyword">...</span>)]}</div></pre></td></tr></table></figure>

<p>注意：</p>
<ul>
<li><strong>执行存储过程前，返回值或OUT参数必须用<code>registerOutParameter</code>注册，执行后返回值或OUT参数使用getXxxx方法获取。还有输入IN参数使用setXxx方法设置值。</strong></li>
<li><strong>参数是根据编号按顺序引用的，第一个参数的编号是 1。</strong></li>
</ul>
<p><code>CallableStatement</code>可以返回一个 <code>ResultSet</code> 对象或多个 <code>ResultSet</code>对象。多个<code>ResultSet</code> 对象是使用继承自 <code>Statement</code>的操作处理的。<br>为了获得最大的可移植性，某一调用的<code>ResultSet</code> 对象和更新计数应该在获得输出参数的值之前处理。</p>
<p>示例：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCallFunction</span>() {                  </div><div class="line">    Connection conn = JDBCUtil.getConnection();   </div><div class="line">    CallableStatement cs = <span class="keyword">null</span>;                  </div><div class="line">    String sql = <span class="string">"{? = call fn_max(?, ?, ?)}"</span>;    </div><div class="line">    <span class="keyword">try</span> {                                         </div><div class="line">        cs = conn.prepareCall(sql);               </div><div class="line">        <span class="comment">// 注册返回值                                  </span></div><div class="line">        cs.registerOutParameter(<span class="number">1</span>, Types.DOUBLE); </div><div class="line">        <span class="comment">// 设置参数                                   </span></div><div class="line">        cs.setDouble(<span class="number">2</span>, <span class="number">142</span>);                     </div><div class="line">        cs.setDouble(<span class="number">3</span>, <span class="number">34</span>);                      </div><div class="line">        cs.setDouble(<span class="number">4</span>, <span class="number">122</span>);                     </div><div class="line">        <span class="comment">// 执行函数/存储过程                              </span></div><div class="line">        cs.execute();                             </div><div class="line">        <span class="comment">// 获取返回值                                  </span></div><div class="line">        Double maxValue = cs.getDouble(<span class="number">1</span>);        </div><div class="line">        System.<span class="keyword">out</span>.println(maxValue);             </div><div class="line">    } <span class="keyword">catch</span> (SQLException e) {                    </div><div class="line">        e.printStackTrace();                      </div><div class="line">    } <span class="keyword">finally</span> {                                   </div><div class="line">        JDBCUtil.release(conn, cs, <span class="keyword">null</span>);         </div><div class="line">    }                                             </div><div class="line">}</div></pre></td></tr></table></figure>

<p>示例代码中调用的MySQL函数为：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">DELIMITER $$</div><div class="line"> </div><div class="line">USE `java3`$$</div><div class="line"> </div><div class="line">DROP <span class="keyword">FUNCTION</span> <span class="keyword">IF</span> EXISTS `fn_max`$$</div><div class="line"> </div><div class="line">CREATE DEFINER=`root`@`localhost` <span class="keyword">FUNCTION</span> `fn_max`(</div><div class="line">    param1 <span class="built_in">DOUBLE</span>,</div><div class="line">    param2 <span class="built_in">DOUBLE</span>,</div><div class="line">    param3 <span class="built_in">DOUBLE</span></div><div class="line">) RETURNS <span class="built_in">DOUBLE</span></div><div class="line">BEGIN</div><div class="line">    <span class="keyword">DECLARE</span> max_val <span class="built_in">DOUBLE</span>;</div><div class="line">    <span class="keyword">IF</span> param1 &gt; param2 <span class="keyword">THEN</span></div><div class="line">    <span class="keyword">SET</span> max_val = param1;</div><div class="line">    <span class="keyword">ELSE</span></div><div class="line">        <span class="keyword">SET</span> max_val = param2;</div><div class="line">    <span class="keyword">END</span> <span class="keyword">IF</span>;</div><div class="line"> </div><div class="line">    <span class="keyword">IF</span> param3 &gt; max_val <span class="keyword">THEN</span></div><div class="line">        <span class="keyword">SET</span> max_val = param3;</div><div class="line">    <span class="keyword">END</span> <span class="keyword">IF</span>;</div><div class="line">    <span class="keyword">RETURN</span> max_val;</div><div class="line"><span class="keyword">END</span>$$</div><div class="line"> </div><div class="line">DELIMITER ;</div></pre></td></tr></table></figure>

  
	</div>
		<footer class="article-footer clearfix">

  <div class="article-tags">
  
  <span></span> <a href="/tags/Java-JDBC/">Java JDBC</a>
  </div>




<div class="article-share" id="share">

  <div data-url="http://yoursite.com/2015/02/14/Java/JDBC/JDBC详解（一）/" data-title="JDBC详解（一） | LC的学习笔记" data-tsina="null" class="share clearfix">
  </div>

</div>
</footer>   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2015/02/15/Database/Oracle/Oracle基础-01：查询、过滤、排序操作/" title="Oracle基础（一）：查询、过滤、排序操作">
  <strong>PREVIOUS:</strong><br/>
  <span>
  Oracle基础（一）：查询、过滤、排序操作</span>
</a>
</div>


<div class="next">
<a href="/2015/02/14/使用Hexo搭建博客/"  title="使用Hexo搭建博客">
 <strong>NEXT:</strong><br/> 
 <span>使用Hexo搭建博客
</span>
</a>
</div>

</nav>

	
</div>  
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">Contents</strong>
  <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#JDBC_API"><span class="toc-number">1.</span> <span class="toc-text">JDBC API</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Driver和Connection接口"><span class="toc-number">1.1.</span> <span class="toc-text">Driver和Connection接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DriverManager类"><span class="toc-number">1.2.</span> <span class="toc-text">DriverManager类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Statement接口"><span class="toc-number">1.3.</span> <span class="toc-text">Statement接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ResultSet接口"><span class="toc-number">1.4.</span> <span class="toc-text">ResultSet接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PreparedStatement"><span class="toc-number">1.5.</span> <span class="toc-text">PreparedStatement</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ResultSetMetaData"><span class="toc-number">1.6.</span> <span class="toc-text">ResultSetMetaData</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CallableStatement"><span class="toc-number">1.7.</span> <span class="toc-text">CallableStatement</span></a></li></ol></li></ol>
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">

  

  
<div class="tagslist">
	<p class="asidetitle">Tags</p>
		<ul class="clearfix">
		
			<li><a href="/tags/Java-JDBC/" title="Java JDBC">Java JDBC<sup>1</sup></a></li>
		
			<li><a href="/tags/Oracle/" title="Oracle">Oracle<sup>6</sup></a></li>
		
			<li><a href="/tags/Oracle-SQL/" title="Oracle SQL">Oracle SQL<sup>0</sup></a></li>
		
			<li><a href="/tags/SQL/" title="SQL">SQL<sup>6</sup></a></li>
		
		</ul>
</div>


  <div class="rsspart">
	<a href="null" target="_blank" title="rss">RSS</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<div class="social-font clearfix">
		
		
		
		
		
	</div>
		<p class="copyright">Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/A-limon/pacman" target="_blank" title="Pacman">Pacman</a> © 2015 
		
		<a href="http://yoursite.com" target="_blank" title="zlc">zlc</a>
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    o.click(function(){
      ta.css('display', 'none');
    });
    $(window).scroll(function(){
      ta.css("top",Math.max(140,320-$(this).scrollTop()));
    });
  };
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});     
</script>






  </body>
</html>
